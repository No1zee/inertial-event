module.exports=[20796,a=>{"use strict";var b=a.i(5816),c=a.i(30770);function d(){return e().getCastState()===cast.framework.CastState.CONNECTED}function e(){return window.cast.framework.CastContext.getInstance()}function f(){return e().getCurrentSession()}function g(){return f()?.getSessionObj().media[0]}function h(a){return g()?.media.contentId===a?.src}function i(a){return`Google Cast Error Code: ${a}`}function j(a,b){return(0,c.listenEvent)(e(),a,b)}var k=Object.freeze({__proto__:null,GoogleCastLoader:class{name="google-cast";target;#a;get cast(){return e()}mediaType(){return"video"}canPlay(a){return b.IS_CHROME&&!b.IS_IOS&&(0,b.canGoogleCastSrc)(a)}async prompt(a){let b,e,g;try{b=await this.#b(a),this.#a||(this.#a=new cast.framework.RemotePlayer,new cast.framework.RemotePlayerController(this.#a)),e=a.player.createEvent("google-cast-prompt-open",{trigger:b}),a.player.dispatchEvent(e),this.#c(a,"connecting",e),await this.#d((0,c.peek)(a.$props.googleCast)),a.$state.remotePlaybackInfo.set({deviceName:f()?.getCastDevice().friendlyName}),d()&&this.#c(a,"connected",e)}catch(f){let c=f instanceof Error?f:this.#e((f+"").toUpperCase(),"Prompt failed.");throw g=a.player.createEvent("google-cast-prompt-error",{detail:c,trigger:e??b,cancelable:!0}),a.player.dispatch(g),this.#c(a,d()?"connected":"disconnected",g),c}finally{a.player.dispatch("google-cast-prompt-close",{trigger:g??e??b})}}async load(c){if(b.IS_SERVER)throw Error("[vidstack] can not load google cast provider server-side");if(!this.#a)throw Error("[vidstack] google cast player was not initialized");return new(await a.A(7589)).GoogleCastProvider(this.#a,c)}async #b(a){if(window.cast?.framework)return;let c=a.player.createEvent("google-cast-load-start");a.player.dispatch(c),await (0,b.loadScript)("https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"),await customElements.whenDefined("google-cast-launcher");let d=a.player.createEvent("google-cast-loaded",{trigger:c});if(a.player.dispatch(d),!window.chrome?.cast?.isAvailable)throw this.#e("CAST_NOT_AVAILABLE","Google Cast not available on this platform.");return d}async #d(a){this.#f(a);let b=await this.cast.requestSession();if(b)throw this.#e(b.toUpperCase(),i(b))}#f(a){this.cast?.setOptions({...{language:"en-US",autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,resumeSavedSession:!0,androidReceiverCompatible:!0},...a})}#c(a,b,c){a.notify("remote-playback-change",{type:"google-cast",state:b},c)}#e(a,b){let c=Error(b);return c.code=a,c}}});a.s(["getCastContext",()=>e,"getCastErrorMessage",()=>i,"getCastSession",()=>f,"getCastSessionMedia",()=>g,"hasActiveCastSession",()=>h,"listenCastContextEvent",()=>j,"loader",()=>k])},55578,a=>{"use strict";var b=a.i(30770),c=a.i(5816),d=a.i(20796);a.i(72131);class e{#g;constructor(a){this.#g=new chrome.cast.media.MediaInfo(a.src,a.type)}build(){return this.#g}setStreamType(a){return a.includes("live")?this.#g.streamType=chrome.cast.media.StreamType.LIVE:this.#g.streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(a){return this.#g.tracks=a.map(this.#h),this}setMetadata(a,b){return this.#g.metadata=new chrome.cast.media.GenericMediaMetadata,this.#g.metadata.title=a,this.#g.metadata.images=[{url:b}],this}#h(a,b){let c=new chrome.cast.media.Track(b,chrome.cast.media.TrackType.TEXT);return c.name=a.label,c.trackContentId=a.src,c.trackContentType="text/vtt",c.language=a.language,c.subtype=a.kind.toUpperCase(),c}}class f{#i;#j;#k;constructor(a,b,c){this.#i=a,this.#j=b,this.#k=c}setup(){let a=this.syncRemoteActiveIds.bind(this);(0,b.listenEvent)(this.#j.audioTracks,"change",a),(0,b.listenEvent)(this.#j.textTracks,"mode-change",a),(0,b.effect)(this.#l.bind(this))}getLocalTextTracks(){return this.#j.$state.textTracks().filter(a=>a.src&&"vtt"===a.type)}#m(){return this.#j.$state.audioTracks()}#n(a){let b=this.#i.mediaInfo?.tracks??[];return a?b.filter(b=>b.type===a):b}#o(){let a=[],b=this.#m().find(a=>a.selected),c=this.getLocalTextTracks().filter(a=>"showing"===a.mode);if(b){let c=this.#n(chrome.cast.media.TrackType.AUDIO),d=this.#p(c,b);d&&a.push(d.trackId)}if(c?.length){let b=this.#n(chrome.cast.media.TrackType.TEXT);if(b.length)for(let d of c){let c=this.#p(b,d);c&&a.push(c.trackId)}}return a}#l(){let a=this.getLocalTextTracks();if(!this.#i.isMediaLoaded)return;let c=this.#n(chrome.cast.media.TrackType.TEXT);for(let d of a)if(!this.#p(c,d)){(0,b.untrack)(()=>this.#k?.());break}}syncRemoteTracks(a){if(!this.#i.isMediaLoaded)return;let b=this.#m(),d=this.getLocalTextTracks(),e=this.#n(chrome.cast.media.TrackType.AUDIO),f=this.#n(chrome.cast.media.TrackType.TEXT);for(let d of e){if(this.#q(b,d))continue;let e={id:d.trackId.toString(),label:d.name,language:d.language,kind:d.subtype??"main",selected:!1};this.#j.audioTracks[c.ListSymbol.add](e,a)}for(let b of f){if(this.#q(d,b))continue;let c={id:b.trackId.toString(),src:b.trackContentId,label:b.name,language:b.language,kind:b.subtype.toLowerCase()};this.#j.textTracks.add(c,a)}}syncRemoteActiveIds(a){if(!this.#i.isMediaLoaded)return;let b=this.#o(),c=new chrome.cast.media.EditTracksInfoRequest(b);this.#r(c).catch(a=>{})}#r(a){let b=(0,d.getCastSessionMedia)();return new Promise((c,d)=>b?.editTracksInfo(a,c,d))}#q(a,b){return a.find(a=>this.#s(a,b))}#p(a,b){return a.find(a=>this.#s(b,a))}#s(a,b){return b.name===a.label&&b.language===a.language&&b.subtype.toLowerCase()===a.kind.toLowerCase()}}class g{$$PROVIDER_TYPE="GOOGLE_CAST";scope=(0,b.createScope)();#a;#j;#t;#u=null;#v="disconnected";#w=0;#x=0;#y=new c.TimeRange(0,0);#z=new c.RAFLoop(this.#A.bind(this));#B;#C=null;#D=!1;constructor(a,b){this.#a=a,this.#j=b,this.#t=new f(a,b,this.#k.bind(this))}get type(){return"google-cast"}get currentSrc(){return this.#u}get player(){return this.#a}get cast(){return(0,d.getCastContext)()}get session(){return(0,d.getCastSession)()}get media(){return(0,d.getCastSessionMedia)()}get hasActiveSession(){return(0,d.hasActiveCastSession)(this.#u)}setup(){this.#E(),this.#F(),this.#t.setup(),this.#j.notify("provider-setup",this)}#E(){(0,d.listenCastContextEvent)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.#G.bind(this))}#F(){let a=cast.framework.RemotePlayerEventType,c={[a.IS_CONNECTED_CHANGED]:this.#G,[a.IS_MEDIA_LOADED_CHANGED]:this.#H,[a.CAN_CONTROL_VOLUME_CHANGED]:this.#I,[a.CAN_SEEK_CHANGED]:this.#J,[a.DURATION_CHANGED]:this.#K,[a.IS_MUTED_CHANGED]:this.#L,[a.VOLUME_LEVEL_CHANGED]:this.#L,[a.IS_PAUSED_CHANGED]:this.#M,[a.LIVE_SEEKABLE_RANGE_CHANGED]:this.#N,[a.PLAYER_STATE_CHANGED]:this.#O};this.#B=c;let d=this.#P.bind(this);for(let a of(0,b.keysOf)(c))this.#a.controller.addEventListener(a,d);(0,b.onDispose)(()=>{for(let a of(0,b.keysOf)(c))this.#a.controller.removeEventListener(a,d)})}async play(){if(this.#a.isPaused||this.#D){if(this.#D)return void await this.#Q(!1,0);this.#a.controller?.playOrPause()}}async pause(){this.#a.isPaused||this.#a.controller?.playOrPause()}getMediaStatus(a){return new Promise((b,c)=>{this.media?.getStatus(a,b,c)})}setMuted(a){(a&&!this.#a.isMuted||!a&&this.#a.isMuted)&&this.#a.controller?.muteOrUnmute()}setCurrentTime(a){this.#a.currentTime=a,this.#j.notify("seeking",a),this.#a.controller?.seek()}setVolume(a){this.#a.volumeLevel=a,this.#a.controller?.setVolumeLevel()}async loadSource(a){if(this.#C?.src!==a&&(this.#C=null),(0,d.hasActiveCastSession)(a)){this.#R(),this.#u=a;return}this.#j.notify("load-start");let b=this.#S(a),c=await this.session.loadMedia(b);if(c){this.#u=null,this.#j.notify("error",Error((0,d.getCastErrorMessage)(c)));return}this.#u=a}destroy(){this.#T(),this.#U()}#T(){this.#C||(this.#x=0,this.#y=new c.TimeRange(0,0)),this.#z.stop(),this.#w=0,this.#C=null}#R(){let a=new b.DOMEvent("resume-session",{detail:this.session});this.#H(a);let{muted:c,volume:d,savedState:e}=this.#j.$state,f=e();this.setCurrentTime(Math.max(this.#a.currentTime,f?.currentTime??0)),this.setMuted(c()),this.setVolume(d()),f?.paused===!1&&this.play()}#U(){this.cast.endCurrentSession(!0);let{remotePlaybackLoader:a}=this.#j.$state;a.set(null)}#V(){let{savedState:a}=this.#j.$state;a.set({paused:this.#a.isPaused,currentTime:this.#a.currentTime}),this.#U()}#A(){this.#W()}#P(a){this.#B[a.type].call(this,a)}#G(a){let b=this.cast.getCastState(),c=b===cast.framework.CastState.CONNECTED?"connected":b===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.#v===c)return;let d=this.#X(a);this.#v=c,this.#j.notify("remote-playback-change",{type:"google-cast",state:c},d),"disconnected"===c&&this.#V()}#H(a){if(!this.#a.isMediaLoaded)return;let d=(0,b.peek)(this.#j.$state.source);Promise.resolve().then(()=>{if(d!==(0,b.peek)(this.#j.$state.source)||!this.#a.isMediaLoaded)return;this.#T();let e=this.#a.duration;this.#y=new c.TimeRange(0,e);let f={provider:this,duration:e,buffered:new c.TimeRange(0,0),seekable:this.#Y()},g=this.#X(a);this.#j.notify("loaded-metadata",void 0,g),this.#j.notify("loaded-data",void 0,g),this.#j.notify("can-play",f,g),this.#I(),this.#J(a);let{volume:h,muted:i}=this.#j.$state;this.setVolume(h()),this.setMuted(i()),this.#z.start(),this.#t.syncRemoteTracks(g),this.#t.syncRemoteActiveIds(g)})}#I(){this.#j.$state.canSetVolume.set(this.#a.canControlVolume)}#J(a){let b=this.#X(a);this.#j.notify("stream-type-change",this.#Z(),b)}#Z(){return this.#a.mediaInfo?.streamType===chrome.cast.media.StreamType.LIVE?this.#a.canSeek?"live:dvr":"live":"on-demand"}#W(){if(this.#C)return;let a=this.#a.currentTime;a!==this.#w&&(this.#j.notify("time-change",a),a>this.#x&&(this.#x=a,this.#N()),this.#j.$state.seeking()&&this.#j.notify("seeked",a),this.#w=a)}#K(a){if(!this.#a.isMediaLoaded||this.#C)return;let b=this.#a.duration,d=this.#X(a);this.#y=new c.TimeRange(0,b),this.#j.notify("duration-change",b,d)}#L(a){if(!this.#a.isMediaLoaded)return;let b={muted:this.#a.isMuted,volume:this.#a.volumeLevel},c=this.#X(a);this.#j.notify("volume-change",b,c)}#M(a){let b=this.#X(a);this.#a.isPaused?this.#j.notify("pause",void 0,b):this.#j.notify("play",void 0,b)}#N(a){let b={seekable:this.#Y(),buffered:new c.TimeRange(0,this.#x)},d=a?this.#X(a):void 0;this.#j.notify("progress",b,d)}#O(a){let b=this.#a.playerState,c=chrome.cast.media.PlayerState;if(this.#D=b===c.IDLE,b===c.PAUSED)return;let d=this.#X(a);switch(b){case c.PLAYING:this.#j.notify("playing",void 0,d);break;case c.BUFFERING:this.#j.notify("waiting",void 0,d);break;case c.IDLE:this.#z.stop(),this.#j.notify("pause"),this.#j.notify("end")}}#Y(){return this.#a.liveSeekableRange?new c.TimeRange(this.#a.liveSeekableRange.start,this.#a.liveSeekableRange.end):this.#y}#X(a){return a instanceof Event?a:new b.DOMEvent(a.type,{detail:a})}#$(a){let{streamType:b,title:c,poster:d}=this.#j.$state;return new e(a).setMetadata(c(),d()).setStreamType(b()).setTracks(this.#t.getLocalTextTracks()).build()}#S(a){let b=this.#$(a),c=new chrome.cast.media.LoadRequest(b),d=this.#j.$state.savedState();return c.autoplay=(this.#C?.paused??d?.paused)===!1,c.currentTime=this.#C?.time??d?.currentTime??0,c}async #Q(a,c){let d=(0,b.peek)(this.#j.$state.source);this.#C={src:d,paused:a,time:c},await this.loadSource(d)}#k(){this.#Q(this.#a.isPaused,this.#a.currentTime).catch(a=>{})}}a.s(["GoogleCastProvider",()=>g])},7589,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_@vidstack_react_prod_chunks_6101b56c._.js"].map(b=>a.l(b))).then(()=>b(55578)))}];

//# sourceMappingURL=node_modules_%40vidstack_react_prod_chunks_6101b56c._.js.map