module.exports=[27023,a=>{"use strict";var b=a.i(30770),c=a.i(5816);a.i(72131);class d{#a;#b;#c=null;#d=null;config={};#e=new Set;get instance(){return this.#c}constructor(a,b){this.#a=a,this.#b=b}setup(a){let{streamType:d}=this.#b.$state,e=(0,b.peek)(d).includes("live"),f=(0,b.peek)(d).includes("ll-");this.#c=new a({lowLatencyMode:f,backBufferLength:f?4:e?8:void 0,renderTextTracksNatively:!1,...this.config});let g=this.#f.bind(this);for(let b of Object.values(a.Events))this.#c.on(b,g);for(let b of(this.#c.on(a.Events.ERROR,this.#g.bind(this)),this.#e))b(this.#c);this.#b.player.dispatch("hls-instance",{detail:this.#c}),this.#c.attachMedia(this.#a),this.#c.on(a.Events.AUDIO_TRACK_SWITCHED,this.#h.bind(this)),this.#c.on(a.Events.LEVEL_SWITCHED,this.#i.bind(this)),this.#c.on(a.Events.LEVEL_LOADED,this.#j.bind(this)),this.#c.on(a.Events.LEVEL_UPDATED,this.#k.bind(this)),this.#c.on(a.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.#l.bind(this)),this.#c.on(a.Events.CUES_PARSED,this.#m.bind(this)),this.#b.qualities[c.QualitySymbol.enableAuto]=this.#n.bind(this),(0,b.listenEvent)(this.#b.qualities,"change",this.#o.bind(this)),(0,b.listenEvent)(this.#b.audioTracks,"change",this.#p.bind(this)),this.#d=(0,b.effect)(this.#q.bind(this))}#r(a,c){return new b.DOMEvent((0,b.camelToKebabCase)(a),{detail:c})}#q(){if(!this.#b.$state.live())return;let a=new c.RAFLoop(this.#s.bind(this));return a.start(),a.stop.bind(a)}#s(){this.#b.$state.liveSyncPosition.set(this.#c?.liveSyncPosition??1/0)}#f(a,b){this.#b.player?.dispatch(this.#r(a,b))}#l(a,b){let d=this.#r(a,b),e=-1;for(let a=0;a<b.tracks.length;a++){let f=b.tracks[a],g=f.subtitleTrack??f.closedCaptions,h=new c.TextTrack({id:`hls-${f.kind}-${a}`,src:g?.url,label:f.label,language:g?.lang,kind:f.kind,default:f.default});h[c.TextTrackSymbol.readyState]=2,h[c.TextTrackSymbol.onModeChange]=()=>{"showing"===h.mode?(this.#c.subtitleTrack=a,e=a):e===a&&(this.#c.subtitleTrack=-1,e=-1)},this.#b.textTracks.add(h,d)}}#m(a,b){let c=this.#c?.subtitleTrack,d=this.#b.textTracks.getById(`hls-${b.type}-${c}`);if(!d)return;let e=this.#r(a,b);for(let a of b.cues)a.positionAlign="auto",d.addCue(a,e)}#h(a,b){let d=this.#b.audioTracks[b.id];if(d){let e=this.#r(a,b);this.#b.audioTracks[c.ListSymbol.select](d,!0,e)}}#i(a,b){let d=this.#b.qualities[b.level];if(d){let e=this.#r(a,b);this.#b.qualities[c.ListSymbol.select](d,!0,e)}}#k(a,b){b.details.totalduration>0&&this.#b.$state.inferredLiveDVRWindow.set(b.details.totalduration)}#j(a,d){if(this.#b.$state.canPlay())return;let{type:e,live:f,totalduration:g,targetduration:h}=d.details,i=this.#r(a,d);this.#b.notify("stream-type-change",f?"EVENT"===e&&Number.isFinite(g)&&h>=10?"live:dvr":"live":"on-demand",i),this.#b.notify("duration-change",g,i);let j=this.#c.media;for(let a of(-1===this.#c.currentLevel&&this.#b.qualities[c.QualitySymbol.setAuto](!0,i),this.#c.audioTracks)){let b={id:a.id.toString(),label:a.name,language:a.lang||"",kind:"main"};this.#b.audioTracks[c.ListSymbol.add](b,i)}for(let a of this.#c.levels){let b={id:a.id?.toString()??a.height+"p",width:a.width,height:a.height,codec:a.codecSet,bitrate:a.bitrate};this.#b.qualities[c.ListSymbol.add](b,i)}j.dispatchEvent(new b.DOMEvent("canplay",{trigger:i}))}#g(a,b){b.fatal&&("mediaError"===b.type?this.#c?.recoverMediaError():this.#t(b.error))}#t(a){this.#b.notify("error",{message:a.message,code:1,error:a})}#n(){this.#c&&(this.#c.currentLevel=-1)}#o(){let{qualities:a}=this.#b;this.#c&&!a.auto&&(this.#c[a.switch+"Level"]=a.selectedIndex,c.IS_CHROME&&(this.#a.currentTime=this.#a.currentTime))}#p(){let{audioTracks:a}=this.#b;this.#c&&this.#c.audioTrack!==a.selectedIndex&&(this.#c.audioTrack=a.selectedIndex)}onInstance(a){return this.#e.add(a),()=>this.#e.delete(a)}loadSource(a){(0,b.isString)(a.src)&&this.#c?.loadSource(a.src)}destroy(){this.#c?.destroy(),this.#c=null,this.#d?.(),this.#d=null}}class e{#u;#b;#v;constructor(a,b,c){this.#u=a,this.#b=b,this.#v=c,this.#w()}async #w(){let a={onLoadStart:this.#x.bind(this),onLoaded:this.#y.bind(this),onLoadError:this.#z.bind(this)},c=await g(this.#u,a);return((0,b.isUndefined)(c)&&!(0,b.isString)(this.#u)&&(c=await f(this.#u,a)),c)?c.isSupported()?c:(this.#b.player.dispatch(new b.DOMEvent("hls-unsupported")),this.#b.notify("error",{message:"[vidstack] `hls.js` is not supported in this environment",code:4}),null):null}#x(){this.#b.player.dispatch(new b.DOMEvent("hls-lib-load-start"))}#y(a){this.#b.player.dispatch(new b.DOMEvent("hls-lib-loaded",{detail:a})),this.#v(a)}#z(a){let d=(0,c.coerceToError)(a);this.#b.player.dispatch(new b.DOMEvent("hls-lib-load-error",{detail:d})),this.#b.notify("error",{message:d.message,code:4,error:d})}}async function f(a,c={}){if(!(0,b.isUndefined)(a)){if(c.onLoadStart?.(),a.prototype&&a.prototype!==Function)return c.onLoaded?.(a),a;try{let b=(await a())?.default;if(b&&b.isSupported)c.onLoaded?.(b);else throw Error("");return b}catch(a){c.onLoadError?.(a)}}}async function g(a,d={}){if((0,b.isString)(a)){d.onLoadStart?.();try{if(await (0,c.loadScript)(a),!(0,b.isFunction)(window.Hls))throw Error("");let e=window.Hls;return d.onLoaded?.(e),e}catch(a){d.onLoadError?.(a)}}}class h extends c.VideoProvider{$$PROVIDER_TYPE="HLS";#A=null;#B=new d(this.video,this.ctx);get ctor(){return this.#A}get instance(){return this.#B.instance}static supported=(0,c.isHLSSupported)();get type(){return"hls"}get canLiveSync(){return!0}#C="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js";get config(){return this.#B.config}set config(a){this.#B.config=a}get library(){return this.#C}set library(a){this.#C=a}preconnect(){(0,b.isString)(this.#C)&&(0,c.preconnect)(this.#C)}setup(){super.setup(),new e(this.#C,this.ctx,a=>{this.#A=a,this.#B.setup(a),this.ctx.notify("provider-setup",this);let c=(0,b.peek)(this.ctx.$state.source);c&&this.loadSource(c)})}async loadSource(a,c){(0,b.isString)(a.src)?(this.media.preload=c||"",this.appendSource(a,"application/x-mpegurl"),this.#B.loadSource(a),this.currentSrc=a):this.removeSource()}onInstance(a){let b=this.#B.instance;return b&&a(b),this.#B.onInstance(a)}destroy(){this.#B.destroy()}}a.s(["HLSProvider",()=>h])}];

//# sourceMappingURL=node_modules_%40vidstack_react_prod_chunks_vidstack-BN7_0WI-_9f1aba64.js.map