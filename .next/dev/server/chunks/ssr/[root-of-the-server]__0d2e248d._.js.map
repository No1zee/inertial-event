{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/api/content.ts"],"sourcesContent":["import axios from \"axios\";\r\nimport { Content } from \"@/lib/types/content\";\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000/api\";\r\n\r\nexport const contentApi = {\r\n    getTrending: async (): Promise<Content[]> => {\r\n        try {\r\n            // Randomize page 1-3 to ensure freshness on reload\r\n            const randomPage = Math.floor(Math.random() * 3) + 1;\r\n            const res = await axios.get(`/tmdb-api/trending/all/day?language=en-US&page=${randomPage}`);\r\n            const data = res.data.results || [];\r\n            return data.map(transformToContent).sort(() => Math.random() - 0.5); // Shuffle results\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch trending:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getPopularTV: async (): Promise<Content[]> => {\r\n        try {\r\n            const randomPage = Math.floor(Math.random() * 5) + 1;\r\n            const res = await axios.get(`/tmdb-api/tv/popular?language=en-US&page=${randomPage}`);\r\n            const data = res.data.results || [];\r\n            return data.map(transformToContent).sort(() => Math.random() - 0.5);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch popular TV:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getByGenre: async (genreId: number, type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const randomPage = page || Math.floor(Math.random() * 5) + 1;\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const res = await axios.get(`${endpoint}?with_genres=${genreId}&language=en-US&page=${randomPage}&sort_by=popularity.desc`);\r\n            const data = res.data.results || [];\r\n            return data.map(transformToContent); // Preserving order for relevance unless specifically shuffled elsewhere\r\n        } catch (error) {\r\n            console.error(`Failed to fetch genre ${genreId}:`, error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    // Flexible discover for custom categories (A24, CBM, etc.)\r\n    discover: async (params: { with_companies?: string; with_keywords?: string; with_genres?: string; sort_by?: string; page?: number }, type: 'movie' | 'tv' = 'movie'): Promise<Content[]> => {\r\n        try {\r\n            const queryParams = new URLSearchParams({\r\n                language: 'en-US',\r\n                page: (params.page || Math.floor(Math.random() * 3) + 1).toString(),\r\n                sort_by: params.sort_by || 'popularity.desc',\r\n                ...params\r\n            } as any);\r\n\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const res = await axios.get(`${endpoint}?${queryParams.toString()}`);\r\n            return (res.data.results || []).map(transformToContent);\r\n        } catch (error) {\r\n            console.error(\"Failed to discover content:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getTrailer: async (id: string, type: 'movie' | 'tv' = 'movie'): Promise<string | null> => {\r\n        try {\r\n            const cleanId = id.replace('tmdb_', '');\r\n            const res = await axios.get(`/tmdb-api/${type}/${cleanId}/videos?language=en-US`);\r\n            const videos = res.data.results || [];\r\n            const trailer = videos.find((v: any) => v.type === \"Trailer\" && v.site === \"YouTube\") || videos[0];\r\n            return trailer ? trailer.key : null;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    },\r\n\r\n    getDetails: async (id: string, type: 'movie' | 'tv' = 'movie'): Promise<Content | null> => {\r\n        try {\r\n            // Strip 'tmdb_' prefix if present\r\n            const cleanId = id.replace('tmdb_', '');\r\n\r\n            const endpoint = `/tmdb-api/${type}/${cleanId}?language=en-US`;\r\n            const res = await axios.get(endpoint);\r\n            return transformToContent({ ...res.data, type });\r\n        } catch (error) {\r\n            console.error(`Failed to fetch ${type} details for ${id}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n};\r\n\r\nconst transformToContent = (item: any): Content => {\r\n    // Helper to extract path and ensure w500/original prefix for the proxy\r\n    const getProxyUrl = (tmdbPath: string | null, fallbackUrl: string | null, size: string, fallbackAsset: string) => {\r\n        if (tmdbPath) {\r\n            // Ensure path is clean (remove leading slash if it exists, proxy adds it)\r\n            const cleanPath = tmdbPath.startsWith('/') ? tmdbPath.substring(1) : tmdbPath;\r\n            return `/tmdb-img/${size}/${cleanPath}`;\r\n        }\r\n        if (fallbackUrl && fallbackUrl.includes('tmdb.org')) {\r\n            const parts = fallbackUrl.split('/t/p/');\r\n            if (parts[1]) return `/tmdb-img/${parts[1]}`;\r\n        }\r\n        return fallbackUrl || fallbackAsset;\r\n    };\r\n\r\n    return {\r\n        id: item._id || item.id || `tmdb_${item.tmdbId}`,\r\n        title: item.title || item.name || \"Unknown Title\",\r\n        description: item.description || item.overview || \"\",\r\n        poster: getProxyUrl(item.poster_path, item.posterUrl, 'w500', \"/images/placeholder.png\"),\r\n        backdrop: getProxyUrl(item.backdrop_path, item.backdropUrl, 'original', \"/images/hero_placeholder.jpg\"),\r\n        rating: item.rating || item.vote_average || 0,\r\n        releaseDate: item.year || item.release_date || item.first_air_date || \"2024\",\r\n        type: (item.type || item.media_type || \"movie\") as 'movie' | 'tv' | 'anime',\r\n        genres: item.genres || [],\r\n        status: 'ongoing',\r\n        isAdult: false\r\n    };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/services/sourceProvider.ts"],"sourcesContent":["interface StreamSource {\r\n    url: string;\r\n    quality: string;\r\n    type: 'hls' | 'mp4' | 'torrent' | 'embed';\r\n}\r\n\r\ninterface ContentItem {\r\n    id: string;\r\n    title: string;\r\n    type: 'anime' | 'movie' | 'series';\r\n}\r\n\r\nclass SourceProvider {\r\n    private consumetAPI = 'https://api.consumet.org';\r\n    private cache: Map<string, Map<string, StreamSource[]>> = new Map();\r\n\r\n    async getSources(contentId: string, type: 'movie' | 'series' | 'anime', title: string): Promise<StreamSource[]> {\r\n        try {\r\n            console.log(`[SourceProvider] Fetching: /api/sources?id=${contentId}&type=${type}&title=${title}`);\r\n            const response = await fetch(`/api/sources?id=${contentId}&type=${type}&title=${encodeURIComponent(title)}`);\r\n            if (!response.ok) {\r\n                console.error(\"[SourceProvider] API error:\", response.status, response.statusText);\r\n                return [];\r\n            }\r\n            const data = await response.json();\r\n            console.log(\"[SourceProvider] Raw API Data:\", data);\r\n            return data.sources || [];\r\n        } catch (error) {\r\n            console.error('Source fetch error:', error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    async getAllSources(\r\n        content: ContentItem\r\n    ): Promise<Map<string, StreamSource[]>> {\r\n        const cacheKey = `${content.type}:${content.id}`;\r\n        if (this.cache.has(cacheKey)) {\r\n            return this.cache.get(cacheKey)!;\r\n        }\r\n\r\n        const sources = new Map<string, StreamSource[]>();\r\n\r\n        // Single call to backend which handles aggregator logic (Vidlink + Torrent + etc)\r\n        const allSources = await this.getSources(content.id, content.type, content.title);\r\n\r\n        if (allSources.length > 0) {\r\n            // Group by type for the UI\r\n            const vidlink = allSources.filter(s => s.type === 'hls' || s.type === 'embed');\r\n            const torrent = allSources.filter(s => s.type === 'torrent' || s.type === 'mp4');\r\n\r\n            if (vidlink.length > 0) sources.set('vidlink', vidlink);\r\n            if (torrent.length > 0) sources.set('torrent', torrent);\r\n        }\r\n\r\n        this.cache.set(cacheKey, sources);\r\n        return sources;\r\n    }\r\n\r\n    clearCache() {\r\n        this.cache.clear();\r\n    }\r\n}\r\n\r\nconst sourceProvider = new SourceProvider();\r\nexport default sourceProvider;\r\n"],"names":[],"mappings":";;;;AAYA,MAAM;IACM,cAAc,2BAA2B;IACzC,QAAkD,IAAI,MAAM;IAEpE,MAAM,WAAW,SAAiB,EAAE,IAAkC,EAAE,KAAa,EAA2B;QAC5G,IAAI;YACA,QAAQ,GAAG,CAAC,CAAC,2CAA2C,EAAE,UAAU,MAAM,EAAE,KAAK,OAAO,EAAE,OAAO;YACjG,MAAM,WAAW,MAAM,MAAM,CAAC,gBAAgB,EAAE,UAAU,MAAM,EAAE,KAAK,OAAO,EAAE,mBAAmB,QAAQ;YAC3G,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,QAAQ,KAAK,CAAC,+BAA+B,SAAS,MAAM,EAAE,SAAS,UAAU;gBACjF,OAAO,EAAE;YACb;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,kCAAkC;YAC9C,OAAO,KAAK,OAAO,IAAI,EAAE;QAC7B,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,EAAE;QACb;IACJ;IAEA,MAAM,cACF,OAAoB,EACgB;QACpC,MAAM,WAAW,GAAG,QAAQ,IAAI,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE;QAChD,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW;YAC1B,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;QAC1B;QAEA,MAAM,UAAU,IAAI;QAEpB,kFAAkF;QAClF,MAAM,aAAa,MAAM,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE,QAAQ,IAAI,EAAE,QAAQ,KAAK;QAEhF,IAAI,WAAW,MAAM,GAAG,GAAG;YACvB,2BAA2B;YAC3B,MAAM,UAAU,WAAW,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,SAAS,EAAE,IAAI,KAAK;YACtE,MAAM,UAAU,WAAW,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,aAAa,EAAE,IAAI,KAAK;YAE1E,IAAI,QAAQ,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,WAAW;YAC/C,IAAI,QAAQ,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,WAAW;QACnD;QAEA,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU;QACzB,OAAO;IACX;IAEA,aAAa;QACT,IAAI,CAAC,KAAK,CAAC,KAAK;IACpB;AACJ;AAEA,MAAM,iBAAiB,IAAI;uCACZ"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/store/playerStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\n\r\ninterface PlayerState {\r\n    isPlaying: boolean;\r\n    volume: number;\r\n    muted: boolean;\r\n    currentTime: number;\r\n    duration: number;\r\n    playbackRate: number;\r\n    quality: string;\r\n    isFullscreen: boolean;\r\n    showControls: boolean;\r\n\r\n    // Actions\r\n    setPlaying: (playing: boolean) => void;\r\n    setVolume: (volume: number) => void;\r\n    setMuted: (muted: boolean) => void;\r\n    setCurrentTime: (time: number) => void;\r\n    setDuration: (duration: number) => void;\r\n    setPlaybackRate: (rate: number) => void;\r\n    setQuality: (quality: string) => void;\r\n    setFullscreen: (fullscreen: boolean) => void;\r\n    setShowControls: (show: boolean) => void;\r\n    reset: () => void;\r\n}\r\n\r\nexport const usePlayerStore = create<PlayerState>()(\r\n    persist(\r\n        (set) => ({\r\n            isPlaying: false,\r\n            volume: 1,\r\n            muted: false,\r\n            currentTime: 0,\r\n            duration: 0,\r\n            playbackRate: 1,\r\n            quality: 'auto',\r\n            isFullscreen: false,\r\n            showControls: true,\r\n\r\n            setPlaying: (isPlaying) => set({ isPlaying }),\r\n            setVolume: (volume) => set({ volume }),\r\n            setMuted: (muted) => set({ muted }),\r\n            setCurrentTime: (currentTime) => set({ currentTime }),\r\n            setDuration: (duration) => set({ duration }),\r\n            setPlaybackRate: (playbackRate) => set({ playbackRate }),\r\n            setQuality: (quality) => set({ quality }),\r\n            setFullscreen: (isFullscreen) => set({ isFullscreen }),\r\n            setShowControls: (showControls) => set({ showControls }),\r\n            reset: () => set({\r\n                isPlaying: false,\r\n                currentTime: 0,\r\n                duration: 0,\r\n                isFullscreen: false,\r\n                showControls: true\r\n            })\r\n        }),\r\n        {\r\n            name: 'novastream-player-storage',\r\n            partialize: (state) => ({\r\n                volume: state.volume,\r\n                muted: state.muted,\r\n                quality: state.quality,\r\n                playbackRate: state.playbackRate\r\n            }),\r\n        }\r\n    )\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AA0BO,MAAM,iBAAiB,IAAA,kJAAM,IAChC,IAAA,wJAAO,EACH,CAAC,MAAQ,CAAC;QACN,WAAW;QACX,QAAQ;QACR,OAAO;QACP,aAAa;QACb,UAAU;QACV,cAAc;QACd,SAAS;QACT,cAAc;QACd,cAAc;QAEd,YAAY,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC3C,WAAW,CAAC,SAAW,IAAI;gBAAE;YAAO;QACpC,UAAU,CAAC,QAAU,IAAI;gBAAE;YAAM;QACjC,gBAAgB,CAAC,cAAgB,IAAI;gBAAE;YAAY;QACnD,aAAa,CAAC,WAAa,IAAI;gBAAE;YAAS;QAC1C,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,YAAY,CAAC,UAAY,IAAI;gBAAE;YAAQ;QACvC,eAAe,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACpD,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,OAAO,IAAM,IAAI;gBACb,WAAW;gBACX,aAAa;gBACb,UAAU;gBACV,cAAc;gBACd,cAAc;YAClB;IACJ,CAAC,GACD;IACI,MAAM;IACN,YAAY,CAAC,QAAU,CAAC;YACpB,QAAQ,MAAM,MAAM;YACpB,OAAO,MAAM,KAAK;YAClB,SAAS,MAAM,OAAO;YACtB,cAAc,MAAM,YAAY;QACpC,CAAC;AACL"}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/VideoPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { MediaPlayer, MediaProvider, Poster, Track } from '@vidstack/react';\r\nimport type { MediaPlayerInstance } from '@vidstack/react';\r\nimport '@vidstack/react/player/styles/default/theme.css';\r\nimport '@vidstack/react/player/styles/default/layouts/video.css';\r\nimport { DefaultVideoLayout, defaultLayoutIcons } from '@vidstack/react/player/layouts/default';\r\nimport { usePlayerStore } from '@/lib/store/playerStore';\r\n\r\ninterface VideoPlayerProps {\r\n    src: string;\r\n    poster?: string;\r\n    title?: string;\r\n    subtitles?: { kind: string; src: string; label: string; language: string; default?: boolean }[];\r\n    onEnded?: () => void;\r\n}\r\n\r\nexport function VideoPlayer({ src, poster, title, subtitles, onEnded }: VideoPlayerProps) {\r\n    const player = useRef<MediaPlayerInstance>(null);\r\n    const {\r\n        setPlaying,\r\n        setDuration,\r\n        setCurrentTime,\r\n        setVolume,\r\n        setMuted,\r\n        setFullscreen\r\n    } = usePlayerStore();\r\n\r\n    useEffect(() => {\r\n        // Sync state with store\r\n        const instance = player.current;\r\n        if (!instance) return;\r\n\r\n        return instance.subscribe((state) => {\r\n            setPlaying(state.playing);\r\n            setDuration(state.duration);\r\n            setCurrentTime(state.currentTime);\r\n            setVolume(state.volume);\r\n            setMuted(state.muted);\r\n            setFullscreen(state.fullscreen);\r\n\r\n            if (state.ended) onEnded?.();\r\n        });\r\n    }, [src, onEnded, setPlaying, setDuration, setCurrentTime, setVolume, setMuted, setFullscreen]);\r\n\r\n    return (\r\n        <div className=\"relative w-full aspect-video bg-black rounded-xl overflow-hidden ring-1 ring-white/10 shadow-2xl\">\r\n            <MediaPlayer\r\n                ref={player}\r\n                title={title}\r\n                src={src}\r\n                className=\"w-full h-full\"\r\n                aspectRatio=\"16/9\"\r\n                load=\"eager\"\r\n                poster={poster}\r\n            >\r\n                <MediaProvider>\r\n                    <Poster className=\"vds-poster\" />\r\n                    {subtitles?.map((track, i) => (\r\n                        <Track key={i} {...track} kind=\"subtitles\" />\r\n                    ))}\r\n                </MediaProvider>\r\n\r\n                {/* \r\n                  Using Default Layout for now. \r\n                  In Phase 4 (Custom Controls), we can replace this with our own UI \r\n                  using Radix/manual controls if desired, but Vidstack's default is very premium customization friendly.\r\n                */}\r\n                <DefaultVideoLayout icons={defaultLayoutIcons} />\r\n            </MediaPlayer>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAIA;AAAA;AACA;AARA;;;;;;;;AAkBO,SAAS,YAAY,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAoB;IACpF,MAAM,SAAS,IAAA,+MAAM,EAAsB;IAC3C,MAAM,EACF,UAAU,EACV,WAAW,EACX,cAAc,EACd,SAAS,EACT,QAAQ,EACR,aAAa,EAChB,GAAG,IAAA,oJAAc;IAElB,IAAA,kNAAS,EAAC;QACN,wBAAwB;QACxB,MAAM,WAAW,OAAO,OAAO;QAC/B,IAAI,CAAC,UAAU;QAEf,OAAO,SAAS,SAAS,CAAC,CAAC;YACvB,WAAW,MAAM,OAAO;YACxB,YAAY,MAAM,QAAQ;YAC1B,eAAe,MAAM,WAAW;YAChC,UAAU,MAAM,MAAM;YACtB,SAAS,MAAM,KAAK;YACpB,cAAc,MAAM,UAAU;YAE9B,IAAI,MAAM,KAAK,EAAE;QACrB;IACJ,GAAG;QAAC;QAAK;QAAS;QAAY;QAAa;QAAgB;QAAW;QAAU;KAAc;IAE9F,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC,qLAAW;YACR,KAAK;YACL,OAAO;YACP,KAAK;YACL,WAAU;YACV,aAAY;YACZ,MAAK;YACL,QAAQ;;8BAER,8OAAC,uLAAa;;sCACV,8OAAC,gLAAM;4BAAC,WAAU;;;;;;wBACjB,WAAW,IAAI,CAAC,OAAO,kBACpB,8OAAC,+KAAK;gCAAU,GAAG,KAAK;gCAAE,MAAK;+BAAnB;;;;;;;;;;;8BASpB,8OAAC,kMAAkB;oBAAC,OAAO,0MAAkB;;;;;;;;;;;;;;;;;AAI7D"}},
    {"offset": {"line": 442, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/WebviewPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\nexport interface WebviewPlayerRef {\r\n    seek: (time: number) => void;\r\n    setVolume: (vol: number) => void;\r\n    togglePlay: () => void;\r\n    setTrack: (index: number) => void;\r\n    setAudioTrack: (index: number) => void;\r\n    setQuality: (index: number) => void;\r\n    setSubtitleStyle: (style: { fontSize?: number, bgOpacity?: number, color?: string }) => void;\r\n    setPlaybackSpeed: (speed: number) => void;\r\n    togglePiP: () => void;\r\n}\r\n\r\ninterface WebviewPlayerProps {\r\n    src: string;\r\n    title?: string;\r\n    initialVolume?: number;\r\n    subtitleStyle?: { fontSize?: number; bgOpacity?: number; color?: string };\r\n    onEnded?: () => void;\r\n    onStateUpdate?: (state: any) => void;\r\n}\r\n\r\nconst WebviewPlayer = forwardRef<WebviewPlayerRef, WebviewPlayerProps>(({ src, title, initialVolume = 1, subtitleStyle, onEnded, onStateUpdate }, ref) => {\r\n    const webviewRef = useRef<any>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const isReadyRef = useRef(false);\r\n    const callbacksRef = useRef({ onStateUpdate, onEnded, subtitleStyle });\r\n\r\n    const safeExecute = (script: string, userGesture = false) => {\r\n        if (!isReadyRef.current || !webviewRef.current) return;\r\n        try {\r\n            // @ts-ignore\r\n            webviewRef.current.executeJavaScript(script, userGesture).catch((e: any) => {\r\n                // Ignore specific lifecycle errors\r\n                if (e.message && e.message.includes('GUEST_VIEW_MANAGER_CALL')) return;\r\n                console.warn(\"[AG] Webview Exec Error:\", e.message);\r\n            });\r\n        } catch (e) { /* ignore sync errors */ }\r\n    };\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        seek: (time) => safeExecute(`window.AG_CMD_SEEK && window.AG_CMD_SEEK(${time})`),\r\n        setVolume: (vol) => safeExecute(`window.AG_CMD_VOL && window.AG_CMD_VOL(${vol})`),\r\n        togglePlay: () => safeExecute(`window.AG_CMD_TOGGLE && window.AG_CMD_TOGGLE()`),\r\n        setTrack: (idx) => safeExecute(`window.AG_CMD_TRACK && window.AG_CMD_TRACK(${idx})`),\r\n        setAudioTrack: (idx) => safeExecute(`window.AG_CMD_AUDIO_TRACK && window.AG_CMD_AUDIO_TRACK(${idx})`),\r\n        setQuality: (idx) => safeExecute(`window.AG_CMD_QUALITY && window.AG_CMD_QUALITY(${idx})`),\r\n        setSubtitleStyle: (style) => safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(style)})`),\r\n        setPlaybackSpeed: (speed) => safeExecute(`window.AG_CMD_SPEED && window.AG_CMD_SPEED(${speed})`),\r\n        togglePiP: () => safeExecute(`window.AG_CMD_PIP && window.AG_CMD_PIP()`, true)\r\n    }));\r\n\r\n    // Keep refs updated with latest props\r\n    useEffect(() => {\r\n        callbacksRef.current = { onStateUpdate, onEnded, subtitleStyle };\r\n    }, [onStateUpdate, onEnded, subtitleStyle]);\r\n\r\n    useEffect(() => {\r\n        if (isReadyRef.current && subtitleStyle) {\r\n            safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(subtitleStyle)})`);\r\n        }\r\n    }, [subtitleStyle]);\r\n\r\n    useEffect(() => {\r\n        const webview = webviewRef.current;\r\n        if (!webview) return;\r\n\r\n        const onDidFinishLoad = () => {\r\n            if (isReadyRef.current) return;\r\n            setIsLoading(false);\r\n\r\n            const script = `\r\n                (function() {\r\n                    const AG_VERSION = 5; // Bump this to force update\r\n                    console.log(\"ðŸ’‰ AG Script Injected & Started (v\" + AG_VERSION + \")\");\r\n                    const START_VOLUME = ${initialVolume};\r\n                    \r\n                    if (window.AG_VERSION === AG_VERSION) {\r\n                         console.log(\"âš ï¸ AG Script v\" + AG_VERSION + \" already installed, skipping\");\r\n                         return;\r\n                    }\r\n                    window.AG_INSTALLED = true;\r\n                    window.AG_VERSION = AG_VERSION;\r\n                    \r\n                    if (window.AG_INTERVAL_ID) clearInterval(window.AG_INTERVAL_ID);\r\n\r\n                    // --- HELPERS ---\r\n                    const getFiber = (n) => {\r\n                        if (!n) return null;\r\n                        const k = Object.keys(n).find(k => k.startsWith('__reactFiber$'));\r\n                        return k ? n[k] : null;\r\n                    };\r\n\r\n                    const scanFiber = (f) => {\r\n                        if(!f) return null;\r\n                        let c = f;\r\n                        let d = 0;\r\n                        while(c && d < 25) {\r\n                            const p = c.memoizedProps || c.pendingProps;\r\n                            if (p && (p.sources || p.tracks || p.qualityLevels || p.audioTracks || p.playlist || (p.config && (p.config.sources || p.config.tracks)))) return p.config || p;\r\n                            c = c.return; d++;\r\n                        }\r\n                        return null;\r\n                    };\r\n\r\n                    const findVideo = (root, depth = 0) => {\r\n                        if (!root) return null;\r\n                        let v = root.querySelector('video');\r\n                        if (v) { console.log(\"ðŸŽ¥ Video Found at depth \" + depth); return v; }\r\n                        \r\n                        // TreeWalker (Shadow DOM)\r\n                        const w = root.createTreeWalker ? root.createTreeWalker((root.body || root), NodeFilter.SHOW_ELEMENT, null, false) : null;\r\n                        if (w) {\r\n                            let n; while(n = w.nextNode()) if(n.shadowRoot) { v = findVideo(n.shadowRoot, depth + 1); if(v) return v; }\r\n                        }\r\n                        \r\n                        // IFrames\r\n                        const fs = root.querySelectorAll('iframe');\r\n                        if (fs.length > 0 && depth < 2) console.log('ðŸ” Scanning ' + fs.length + ' iframes at depth ' + depth);\r\n                        for(let f of fs) { \r\n                            try { \r\n                                let d = f.contentDocument || f.contentWindow?.document; \r\n                                if(d) { v = findVideo(d, depth + 1); if(v) return v; }\r\n                            } catch(e){ console.log(\"â›” Frame Access Blocked at depth \" + depth); } \r\n                        }\r\n                        return null;\r\n                    };\r\n\r\n                    const sanitizeAudio = (label, lang, idx, src) => {\r\n                        const generic = ['SoundHandler', 'GPAC ISO Audio Handler', 'mp4a', 'iso2'];\r\n                        \r\n                        // If we have a good label, use it\r\n                        if (label && !generic.some(g => label.includes(g))) return label;\r\n                        \r\n                        // Try to extract language from src URL patterns\r\n                        let detectedLang = lang;\r\n                        if (!detectedLang && src) {\r\n                            const s = src.toLowerCase();\r\n                            if (s.includes('/en/') || s.includes('_eng') || s.includes('-english')) detectedLang = 'en';\r\n                            else if (s.includes('/es/') || s.includes('_esp') || s.includes('-spanish')) detectedLang = 'es';\r\n                            else if (s.includes('/fr/') || s.includes('_fre') || s.includes('-french')) detectedLang = 'fr';\r\n                            else if (s.includes('/de/') || s.includes('_ger') || s.includes('-german')) detectedLang = 'de';\r\n                            else if (s.includes('/it/') || s.includes('_ita') || s.includes('-italian')) detectedLang = 'it';\r\n                            else if (s.includes('/pt/') || s.includes('_por') || s.includes('-portuguese')) detectedLang = 'pt';\r\n                            else if (s.includes('/ja/') || s.includes('_jpn') || s.includes('-japanese')) detectedLang = 'ja';\r\n                            else if (s.includes('/ko/') || s.includes('_kor') || s.includes('-korean')) detectedLang = 'ko';\r\n                            else if (s.includes('/zh/') || s.includes('_chi') || s.includes('-chinese')) detectedLang = 'zh';\r\n                            else if (s.includes('/ru/') || s.includes('_rus') || s.includes('-russian')) detectedLang = 'ru';\r\n                        }\r\n                        \r\n                        // Convert language code to display name\r\n                        let displayName = detectedLang || 'Unknown';\r\n                        if (detectedLang && detectedLang.length >= 2) {\r\n                            try {\r\n                                const intlName = new Intl.DisplayNames(['en'], { type: 'language' }).of(detectedLang);\r\n                                if (intlName && intlName !== 'root' && intlName !== 'und') displayName = intlName;\r\n                            } catch(e) {}\r\n                        }\r\n                        \r\n                        return displayName.charAt(0).toUpperCase() + displayName.slice(1) + ' ' + (idx + 1);\r\n                    };\r\n\r\n                    // --- ENGINE ---\r\n                    window.AG_VIDEO = null;\r\n                    const updateState = () => {\r\n                        if (!window.AG_VIDEO || !window.AG_VIDEO.isConnected) {\r\n                            window.AG_VIDEO = findVideo(document);\r\n                            if (window.AG_VIDEO) {\r\n                                const v = window.AG_VIDEO;\r\n                                if (!v.hasAGListeners) {\r\n                                    v.hasAGListeners = true;\r\n                                    console.log('ðŸŽ¥ Video Attached (v5): src=' + (v.currentSrc || v.src) + ', readyState=' + v.readyState + ', networkState=' + v.networkState);\r\n                                    \r\n                                    ['loadstart', 'loadedmetadata', 'canplay', 'playing', 'waiting', 'stalled', 'error', 'ended'].forEach(evt => {\r\n                                        v.addEventListener(evt, (e) => {\r\n                                            let detail = \"\";\r\n                                            if (evt === 'error' && v.error) detail = \" Code: \" + v.error.code + \" Msg: \" + v.error.message;\r\n                                            console.log('ðŸŽ¬ Video Event (v5): ' + evt + detail);\r\n                                        });\r\n                                    });\r\n\r\n                                    // Attempt muted autoplay first\r\n                                    v.muted = true;\r\n                                    v.volume = 0;\r\n                                    v.autoplay = true;\r\n                                    v.setAttribute('autoplay', 'true');\r\n                                    \r\n                                    const attemptPlay = () => {\r\n                                        v.play().then(() => {\r\n                                            console.log(\"â–¶ï¸ Playback started (muted)\");\r\n                                        }).catch(e => {\r\n                                            console.log(\"âš ï¸ Playback failed: \" + e.message);\r\n                                            // Aggressive retry on interactions\r\n                                            const trigger = () => {\r\n                                                v.play().then(() => {\r\n                                                    console.log(\"â–¶ï¸ Playback recovered on interaction\");\r\n                                                    window.removeEventListener('click', trigger);\r\n                                                }).catch(() => {});\r\n                                            };\r\n                                            window.addEventListener('click', trigger, { once: true });\r\n                                        });\r\n                                    };\r\n                                    \r\n                                    if (v.readyState > 2) attemptPlay();\r\n                                    else v.addEventListener('canplay', attemptPlay, { once: true });\r\n                                }\r\n                            }\r\n                        }\r\n                        // Retry finding video periodically if current one is invalid\r\n                        if (window.AG_VIDEO && !window.AG_VIDEO.isConnected) window.AG_VIDEO = null;\r\n                        \r\n                        // Monitor Player State (JW / HLS)\r\n                        const v = window.AG_VIDEO;\r\n                        if (v) {\r\n                            if (window.jwplayer) {\r\n                                try {\r\n                                    const state = window.jwplayer().getState();\r\n                                    if (window.AG_LAST_JW_STATE !== state) {\r\n                                        console.log(\"ðŸ“º JWPlayer State:\", state);\r\n                                        window.AG_LAST_JW_STATE = state;\r\n                                    }\r\n                                } catch(e) {}\r\n                            }\r\n                            if (v.paused && !v.ended && v.readyState > 2 && !v.dataset.manualPause) {\r\n                                 v.play().catch(() => {});\r\n                            }\r\n                        }\r\n                        if (!v) return;\r\n\r\n                        const s = {\r\n                            currentTime: v.currentTime,\r\n                            duration: v.duration,\r\n                            volume: v.muted ? 0 : v.volume,\r\n                            isPaused: v.paused,\r\n                            tracks: [], audioTracks: [], qualities: []\r\n                        };\r\n\r\n                        // Native\r\n                        if(v.textTracks) for(let i=0; i<v.textTracks.length; i++) {\r\n                            const t = v.textTracks[i];\r\n                            s.tracks.push({ label: t.label || t.language || 'Track ' + (i+1), language: t.language, active: t.mode === 'showing' });\r\n                        }\r\n                        if(v.audioTracks) for(let i=0; i<v.audioTracks.length; i++) {\r\n                            const t = v.audioTracks[i];\r\n                            s.audioTracks.push({ label: sanitizeAudio(t.label, t.language, i, v.currentSrc || v.src), language: t.language, active: t.enabled });\r\n                        }\r\n\r\n                        // Player Wrappers (JW / HLS / Fiber)\r\n                        const jw = window.jwplayer ? window.jwplayer() : null;\r\n                        const hls = window.hls || window.Hls || v.__hls__;\r\n\r\n                        if (jw) {\r\n                            try {\r\n                                if (s.tracks.length === 0 && jw.getCaptionsList) (jw.getCaptionsList() || []).forEach((c, i) => s.tracks.push({ label: c.label || c.name || 'Track ' + (i+1), active: i === jw.getCurrentCaptions() }));\r\n                                if (s.audioTracks.length === 0 && jw.getAudioTracks) (jw.getAudioTracks() || []).forEach((a, i) => s.audioTracks.push({ label: sanitizeAudio(a.label, a.language, i, v.currentSrc || v.src), active: i === jw.getCurrentAudioTrack() }));\r\n                                if (jw.getQualityLevels) (jw.getQualityLevels() || []).forEach((q, i) => s.qualities.push({ label: q.label, height: q.height, active: i === jw.getCurrentQuality() }));\r\n                            } catch(e) { console.log('âš ï¸ JW Error:', e.message); }\r\n                        }\r\n                        if (hls && s.audioTracks.length === 0) hls.audioTracks.forEach((t, i) => s.audioTracks.push({ label: sanitizeAudio(t.name || t.label, t.lang, i, v.currentSrc || v.src), active: i === hls.audioTrack }));\r\n                        \r\n                        // Fiber Probe\r\n                        if (s.audioTracks.length === 0 || s.qualities.length === 0) {\r\n                            const p = scanFiber(getFiber(v) || getFiber(v.parentElement));\r\n                            if (p) {\r\n                                if (s.audioTracks.length === 0 && p.audioTracks) p.audioTracks.forEach((t, i) => s.audioTracks.push({ label: sanitizeAudio(t.label || t.name, t.language, i, v.currentSrc || v.src), active: t.active || t.enabled }));\r\n                                if (s.qualities.length === 0 && p.qualityLevels) p.qualityLevels.forEach((q, i) => s.qualities.push({ label: q.label || q.name, height: q.height, active: q.active || i === p.currentQuality }));\r\n                            }\r\n                        }\r\n\r\n                        console.log('ANTIGRAVITY_UPDATE:' + JSON.stringify(s));\r\n                    };\r\n\r\n                    window.AG_INTERVAL_ID = setInterval(updateState, 1000);\r\n\r\n                    // --- COMMANDS ---\r\n                    window.AG_CMD_SEEK = (t) => { \r\n                        console.log('ðŸŽ¯ AG_CMD_SEEK called with time:', t, 'AG_VIDEO exists:', !!window.AG_VIDEO);\r\n                        if(window.AG_VIDEO) {\r\n                            console.log('Current time before seek:', window.AG_VIDEO.currentTime);\r\n                            window.AG_VIDEO.currentTime = t;\r\n                            console.log('Current time after seek:', window.AG_VIDEO.currentTime);\r\n                        } else {\r\n                            console.error('âŒ AG_VIDEO not found, cannot seek');\r\n                        }\r\n                    };\r\n                    window.AG_CMD_VOL = (v) => { if(window.AG_VIDEO) { window.AG_VIDEO.volume = v; window.AG_VIDEO.muted = v === 0; } };\r\n                    window.AG_CMD_TOGGLE = () => { if(window.AG_VIDEO) { if(window.AG_VIDEO.paused) window.AG_VIDEO.play(); else window.AG_VIDEO.pause(); } };\r\n                    window.AG_CMD_SPEED = (s) => { if(window.AG_VIDEO) window.AG_VIDEO.playbackRate = s; };\r\n                    window.AG_CMD_PIP = () => { if(window.AG_VIDEO) { if (document.pictureInPictureElement) document.exitPictureInPicture(); else window.AG_VIDEO.requestPictureInPicture(); } };\r\n                    window.AG_CMD_TRACK = (idx) => {\r\n                        const v = window.AG_VIDEO; if(!v) return;\r\n                        if(v.textTracks) for(let i=0; i<v.textTracks.length; i++) v.textTracks[i].mode = (i === idx) ? 'showing' : 'hidden';\r\n                        if(window.jwplayer) try { window.jwplayer().setCurrentCaptions(idx); } catch(e){}\r\n                    };\r\n                    window.AG_CMD_AUDIO_TRACK = (idx) => {\r\n                        const v = window.AG_VIDEO; if(!v) return;\r\n                        if(v.audioTracks) for(let i=0; i<v.audioTracks.length; i++) v.audioTracks[i].enabled = (i === idx);\r\n                        if(window.jwplayer) try { window.jwplayer().setCurrentAudioTrack(idx); } catch(e){}\r\n                        const h = window.hls || window.Hls; if(h) h.audioTrack = idx;\r\n                    };\r\n                    window.AG_CMD_QUALITY = (idx) => {\r\n                        if(window.jwplayer) try { window.jwplayer().setCurrentQuality(idx); } catch(e){}\r\n                        const h = window.hls || window.Hls; if(h) h.currentLevel = idx;\r\n                    };\r\n\r\n                    window.AG_CMD_SUB_STYLE = (s) => {\r\n                        const id = 'ag-sub-style';\r\n                        const css = \\`\r\n                            video::cue, video::-webkit-media-text-track-display { \r\n                                font-size: \\${s.fontSize || 18}px !important; \r\n                                background-color: rgba(0,0,0,\\${s.bgOpacity ?? 0.5}) !important; \r\n                                color: \\${s.color || '#fff'} !important; \r\n                            }\r\n                            [class*=\"subtitle\"], [class*=\"caption\"] { font-size: \\${s.fontSize || 18}px !important; color: \\${s.color || '#fff'} !important; }\r\n                        \\`;\r\n                        const inject = (root) => {\r\n                            if(!root) return;\r\n                            try {\r\n                                let el = root.getElementById(id);\r\n                                if(!el) { el = document.createElement('style'); el.id = id; (root.head || root.body || root).appendChild(el); }\r\n                                el.textContent = css;\r\n                            } catch(e){}\r\n                            root.querySelectorAll?.('iframe').forEach(f => { try { inject(f.contentDocument || f.contentWindow?.document); } catch(e){} });\r\n                            if(root.createTreeWalker) {\r\n                                const w = root.createTreeWalker((root.body || root), NodeFilter.SHOW_ELEMENT, null, false);\r\n                                let n; while(n = w.nextNode()) if(n.shadowRoot) inject(n.shadowRoot);\r\n                            }\r\n                        };\r\n                        inject(document);\r\n                    };\r\n\r\n                    // 1. Softened popup blocking\r\n                    // Restore basic window.open blocking to prevent popup creation attempts\r\n                    window.open = function() { return null; };\r\n                    // window.alert = function() {}; // Keep alert blocked as it's rarely used legitimately in embeds\r\n                    // window.confirm = function() { return false; };\r\n                    window.onbeforeunload = null; \r\n                    \r\n                    // 2. Comprehensive CSS blocking\r\n                    const blockCss = \\`\r\n                        /* Native Controls */\r\n                        video::-webkit-media-controls-panel,\r\n                        video::-webkit-media-controls-play-button,\r\n                        video::-webkit-media-controls-start-playback-button { \r\n                            display: none !important; \r\n                        }\r\n                        \r\n                        /* Ads & Popups & Overlays */\r\n                        .ad, .ads, .advertisement, [class*=\"ad-\"], [id*=\"ad-\"],\r\n                        .popup, [class*=\"popup\"], [id*=\"popup\"],\r\n                        .modal, [class*=\"modal\"], [id*=\"modal\"],\r\n                        .overlay, [class*=\"overlay\"], [id*=\"overlay\"],\r\n                        [class*=\"watermark\"], [id*=\"watermark\"],\r\n                        [class*=\"promo\"], [id*=\"promo\"],\r\n                        [class*=\"banner\"], [id*=\"banner\"],\r\n                        iframe[src*=\"google\"], iframe[src*=\"ads\"], iframe[src*=\"doubleclick\"], iframe[src*=\"pop\"],\r\n                        #logo, .logo, [class*=\"logo\"], [id*=\"logo\"],\r\n                        a[href*=\"chaturbate\"], a[href*=\"faphouse\"], a[href*=\"bet\"], a[href*=\"casino\"],\r\n                        [class*=\"chat\"], [id*=\"chat\"],\r\n                        [class*=\"register\"], [id*=\"register\"],\r\n                        [class*=\"sign-up\"], [id*=\"signup\"],\r\n                        [class*=\"browser\"], [id*=\"browser\"],\r\n                        [class*=\"download\"], [id*=\"download\"],\r\n                        #preloader, .preloader, [class*=\"loading-overlay\"] {\r\n                            display: none !important;\r\n                            opacity: 0 !important;\r\n                            visibility: hidden !important;\r\n                            pointer-events: none !important;\r\n                            width: 0 !important;\r\n                            height: 0 !important;\r\n                            position: absolute !important;\r\n                            left: -9999px !important;\r\n                            top: -9999px !important;\r\n                            transform: scale(0) !important;\r\n                        }\r\n                        \r\n                        /* Fix potential Z-index issues for video */\r\n                        video {\r\n                            z-index: 2147483647 !important;\r\n                        }\r\n\r\n                        /* Page Styling */\r\n                        body, html { \r\n                            background: #000 !important; \r\n                            overflow: hidden !important; \r\n                        }\r\n                        video { \r\n                            object-fit: contain !important; \r\n                            background: #000 !important; \r\n                        }\r\n                    \\`;\r\n                    \r\n                    const styleEl = document.createElement('style');\r\n                    styleEl.id = 'ag-block-all';\r\n                    styleEl.textContent = blockCss;\r\n                    document.head.appendChild(styleEl);\r\n                    \r\n                    // 3. Continuously remove popup elements (DOM Observer)\r\n                    const killPopups = () => {\r\n                        const selectors = [\r\n                            '[class*=\"popup\"]', '[id*=\"popup\"]',\r\n                            '[class*=\"modal\"]', '[id*=\"modal\"]',\r\n                            '[class*=\"overlay\"]', '[id*=\"overlay\"]',\r\n                            '[class*=\"ad\"]', '[id*=\"ad\"]',\r\n                            'iframe[src*=\"ads\"]', 'iframe[src*=\"chat\"]', 'iframe[src*=\"pop\"]',\r\n                            '[class*=\"banner\"]', '[id*=\"banner\"]',\r\n                            '[class*=\"notice\"]', '[id*=\"notice\"]',\r\n                            'a[target=\"_blank\"]',\r\n                            '[style*=\"z-index: 2147483647\"]', // Often used by ads, but be careful with video\r\n                            '[style*=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%\"]' // Full screen overlays\r\n                        ];\r\n                        selectors.forEach(sel => {\r\n                            try {\r\n                                document.querySelectorAll(sel).forEach(el => {\r\n                                    if (el && el.parentNode && el !== document.body && el !== document.documentElement && el.tagName !== 'VIDEO') {\r\n                                        // Specific check to not kill the video container if it uses these styles\r\n                                        if (el.contains(window.AG_VIDEO)) return;\r\n                                        \r\n                                        // Safe removal\r\n                                        try {\r\n                                             if (el.parentNode) el.parentNode.removeChild(el);\r\n                                             else el.remove();\r\n                                        } catch(e) {}\r\n                                    }\r\n                                });\r\n                             } catch(e) {}\r\n                        });\r\n                    };\r\n                    \r\n                    // Run frequently\r\n                    setInterval(killPopups, 250);\r\n                    killPopups();\r\n                    \r\n                    // 4. Click Blocking removed (Requested to scrap global popup)\r\n                    /*\r\n                    document.addEventListener('click', (e) => {\r\n                        if (e.target.tagName !== 'VIDEO' && e.target.closest('video') === null) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            return false;\r\n                        }\r\n                    }, true);\r\n                    */\r\n                    \r\n                    // 5. MutationObserver to kill popups as they're added\r\n                    const observer = new MutationObserver(() => killPopups());\r\n                    observer.observe(document.body || document.documentElement, { childList: true, subtree: true });\r\n                })();\r\n            `;\r\n\r\n            webview.executeJavaScript(script);\r\n            isReadyRef.current = true;\r\n            if (subtitleStyle) safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(subtitleStyle)})`);\r\n        };\r\n\r\n        const onConsole = (e: any) => {\r\n            const msg = e.message;\r\n            // Ignore benign ad-block errors\r\n            if (msg.includes('Refused to execute script') && msg.includes('MIME type')) return;\r\n\r\n            if (msg.startsWith('ANTIGRAVITY_UPDATE:')) {\r\n                try {\r\n                    const data = JSON.parse(msg.substring(19));\r\n                    callbacksRef.current.onStateUpdate?.(data);\r\n                } catch (e) { }\r\n            } else if (msg === 'ANTIGRAVITY_ENDED') {\r\n                callbacksRef.current.onEnded?.();\r\n            } else {\r\n                // Ignore security and ad-related noise\r\n                if (msg.includes('Electron Security Warning')) return;\r\n                if (msg.includes('Content-Security-Policy')) return;\r\n                if (msg.includes('preloaded using link preload but not used')) return;\r\n                if (msg.includes('yandex.ru')) return;\r\n                if (msg.includes('google-analytics')) return;\r\n                if (msg.includes('Failed to load resource')) return; // Generic noise\r\n                if (msg.includes('The resource was requested using a link that was not recognized')) return;\r\n                if (msg.includes('Autoplay is only allowed')) return;\r\n\r\n                // Determine log level\r\n                if (e.level === 2) console.warn('[Webview]', msg);\r\n                else if (e.level === 3) console.error('[Webview]', msg);\r\n                else console.log('[Webview]', msg);\r\n            }\r\n        };\r\n\r\n        const onDomReady = () => {\r\n            console.log('âœ… Webview: dom-ready');\r\n            onDidFinishLoad();\r\n        };\r\n        const onDidFinishLoadEvent = () => {\r\n            console.log('âœ… Webview: did-finish-load');\r\n            onDidFinishLoad();\r\n        };\r\n        const onDidFailLoad = (e: any) => console.log('âŒ Webview: did-fail-load', e.errorCode, e.errorDescription);\r\n        const onCrashed = (e: any) => console.log('ðŸ’¥ Webview: crashed', e);\r\n\r\n        webview.addEventListener('did-finish-load', onDidFinishLoadEvent);\r\n        webview.addEventListener('dom-ready', onDomReady);\r\n        webview.addEventListener('did-fail-load', onDidFailLoad);\r\n        webview.addEventListener('crashed', onCrashed);\r\n        webview.addEventListener('console-message', onConsole);\r\n\r\n        // Prevent all popups from the webview to avoid main process window creation (which triggers the \"Destroyer\")\r\n        // @ts-ignore\r\n        webview.addEventListener('new-window', (e: any) => {\r\n            console.log('[Webview] Blocked popup:', e.url);\r\n            e.preventDefault();\r\n        });\r\n\r\n        return () => {\r\n            isReadyRef.current = false;\r\n            webview.removeEventListener('did-finish-load', onDidFinishLoadEvent);\r\n            webview.removeEventListener('dom-ready', onDomReady);\r\n            webview.removeEventListener('did-fail-load', onDidFailLoad);\r\n            webview.removeEventListener('crashed', onCrashed);\r\n            webview.removeEventListener('console-message', onConsole);\r\n        };\r\n    }, [src, initialVolume]); // Only re-run if src or volume changes (volume is usually static initially)\r\n\r\n    return (\r\n        <div className=\"relative w-full h-full bg-black flex items-center justify-center overflow-hidden\">\r\n            {isLoading && (\r\n                <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n                    <Loader2 className=\"w-10 h-10 text-white animate-spin\" />\r\n                </div>\r\n            )}\r\n            <webview\r\n                ref={webviewRef}\r\n                src={src}\r\n                className=\"w-full h-full border-0\"\r\n                style={{ width: '100vw', height: '100vh', background: '#000' }}\r\n                // @ts-ignore\r\n                // @ts-ignore\r\n                allowpopups=\"false\"\r\n                // @ts-ignore\r\n                disablewebsecurity=\"true\"\r\n                webpreferences=\"contextIsolation=no, nodeIntegration=no, webSecurity=no, autoplayPolicy=no-user-gesture-required\"\r\n                useragent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36\"\r\n            />\r\n        </div>\r\n    );\r\n});\r\n\r\nWebviewPlayer.displayName = \"WebviewPlayer\";\r\nexport default WebviewPlayer;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1002, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\nexport function formatDuration(minutes: number): string {\r\n    const h = Math.floor(minutes / 60);\r\n    const m = minutes % 60;\r\n    return h > 0 ? `${h}h ${m}m` : `${m}m`;\r\n}\r\n\r\nexport function formatDate(date: string): string {\r\n    return new Date(date).toLocaleDateString(\"en-US\", {\r\n        year: \"numeric\",\r\n        month: \"long\",\r\n        day: \"numeric\",\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACxB;AAEO,SAAS,eAAe,OAAe;IAC1C,MAAM,IAAI,KAAK,KAAK,CAAC,UAAU;IAC/B,MAAM,IAAI,UAAU;IACpB,OAAO,IAAI,IAAI,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC;AAC1C;AAEO,SAAS,WAAW,IAAY;IACnC,OAAO,IAAI,KAAK,MAAM,kBAAkB,CAAC,SAAS;QAC9C,MAAM;QACN,OAAO;QACP,KAAK;IACT;AACJ"}},
    {"offset": {"line": 1033, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/UI/button.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { motion, HTMLMotionProps } from \"framer-motion\";\r\nimport { Loader2, Check, X } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n    variant?: \"primary\" | \"secondary\" | \"ghost\" | \"danger\";\r\n    size?: \"sm\" | \"md\" | \"lg\";\r\n    state?: \"default\" | \"loading\" | \"success\" | \"error\";\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(({\r\n    className,\r\n    variant = \"primary\",\r\n    size = \"md\",\r\n    state = \"default\",\r\n    children,\r\n    disabled,\r\n    ...props\r\n}, ref) => {\r\n\r\n    const variants = {\r\n        primary: \"bg-white text-black hover:bg-zinc-200 shadow-lg hover:shadow-xl\",\r\n        secondary: \"bg-zinc-800 text-white border border-white/10 hover:bg-zinc-700 hover:border-white/20\",\r\n        ghost: \"bg-transparent text-zinc-300 hover:text-white hover:bg-white/5\",\r\n        danger: \"bg-red-600 text-white hover:bg-red-500 shadow-red-900/20\"\r\n    };\r\n\r\n    const sizes = {\r\n        sm: \"px-3 py-1.5 text-xs\",\r\n        md: \"px-6 py-3 text-sm font-semibold\",\r\n        lg: \"px-8 py-4 text-base font-bold\"\r\n    };\r\n\r\n    const widthMap = {\r\n        default: \"auto\",\r\n        loading: \"auto\",\r\n        success: \"auto\",\r\n        error: \"auto\"\r\n    }\r\n\r\n    return (\r\n        <motion.button\r\n            ref={ref}\r\n            className={cn(\r\n                \"relative rounded-full inline-flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden\",\r\n                variants[variant],\r\n                sizes[size],\r\n                className\r\n            )}\r\n            disabled={state === 'loading' || disabled}\r\n            whileHover={state === 'default' && !disabled ? { scale: 1.02, y: -1 } : {}}\r\n            whileTap={state === 'default' && !disabled ? { scale: 0.98 } : {}}\r\n            layout\r\n            {...props as any} // Cast to any to avoid complex framer-motion type conflicts with ref\r\n        >\r\n            {state === 'loading' && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, width: 0 }}\r\n                    animate={{ opacity: 1, width: \"auto\" }}\r\n                    exit={{ opacity: 0, width: 0 }}\r\n                >\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                </motion.div>\r\n            )}\r\n\r\n            {children}\r\n\r\n            {state === 'success' && (\r\n                <motion.div\r\n                    initial={{ scale: 0 }}\r\n                    animate={{ scale: 1 }}\r\n                    className=\"ml-2 text-green-500\"\r\n                >\r\n                    <Check size={18} />\r\n                </motion.div>\r\n            )}\r\n        </motion.button>\r\n    );\r\n});\r\n\r\nButton.displayName = \"Button\";\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAcO,MAAM,uBAAS,mNAAgB,CAAiC,CAAC,EACpE,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,QAAQ,SAAS,EACjB,QAAQ,EACR,QAAQ,EACR,GAAG,OACN,EAAE;IAEC,MAAM,WAAW;QACb,SAAS;QACT,WAAW;QACX,OAAO;QACP,QAAQ;IACZ;IAEA,MAAM,QAAQ;QACV,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,MAAM,WAAW;QACb,SAAS;QACT,SAAS;QACT,SAAS;QACT,OAAO;IACX;IAEA,qBACI,8OAAC,oLAAM,CAAC,MAAM;QACV,KAAK;QACL,WAAW,IAAA,yHAAE,EACT,yJACA,QAAQ,CAAC,QAAQ,EACjB,KAAK,CAAC,KAAK,EACX;QAEJ,UAAU,UAAU,aAAa;QACjC,YAAY,UAAU,aAAa,CAAC,WAAW;YAAE,OAAO;YAAM,GAAG,CAAC;QAAE,IAAI,CAAC;QACzE,UAAU,UAAU,aAAa,CAAC,WAAW;YAAE,OAAO;QAAK,IAAI,CAAC;QAChE,MAAM;QACL,GAAG,KAAK;;YAER,UAAU,2BACP,8OAAC,oLAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAO;gBACrC,MAAM;oBAAE,SAAS;oBAAG,OAAO;gBAAE;0BAE7B,cAAA,8OAAC,uNAAO;oBAAC,WAAU;;;;;;;;;;;YAI1B;YAEA,UAAU,2BACP,8OAAC,oLAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,OAAO;gBAAE;gBACpB,SAAS;oBAAE,OAAO;gBAAE;gBACpB,WAAU;0BAEV,cAAA,8OAAC,6MAAK;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAKjC;AAEA,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 1139, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/app/watch/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { ArrowLeft, Loader2, AlertCircle } from \"lucide-react\";\r\nimport { contentApi } from \"@/lib/api/content\";\r\nimport sourceProvider from \"@/services/sourceProvider\";\r\nimport { VideoPlayer } from \"@/components/player/VideoPlayer\";\r\nimport WebviewPlayer from \"@/components/player/WebviewPlayer\";\r\nimport { Button } from \"@/components/UI/button\";\r\nimport { Content } from \"@/lib/types/content\";\r\n\r\nexport default function WatchPage({ params }: { params: Promise<{ id: string }> }) {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const type = (searchParams.get(\"type\") as 'movie' | 'tv') || 'movie';\r\n\r\n    // Unwrap params (Next.js 15+)\r\n    const { id } = React.use(params);\r\n\r\n    const [content, setContent] = useState<Content | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [sourceUrl, setSourceUrl] = useState<string | null>(null);\r\n    const [isEmbed, setIsEmbed] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        async function loadData() {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            try {\r\n                // 1. Fetch Content Details\r\n                const details = await contentApi.getDetails(id, type);\r\n                if (!mounted) return;\r\n\r\n                if (!details) {\r\n                    setError(\"Content not found\");\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n                setContent(details);\r\n\r\n                // 2. Fetch Sources\r\n                // MAPPING: backend expects specific types\r\n                const sourceType = type === 'movie' ? 'movie' : type === 'tv' ? 'series' : 'anime';\r\n\r\n                const sourcesMap = await sourceProvider.getAllSources({\r\n                    id: details.id, // ID might need adjustment if provider expects specific format\r\n                    title: details.title,\r\n                    type: sourceType\r\n                });\r\n\r\n                if (!mounted) return;\r\n\r\n                // 3. Select Best Source\r\n                let bestSourceObj: any = null; // Typing 'any' to avoid strict checks for now\r\n\r\n                console.log(\"[WatchPage] Sources Map keys:\", Array.from(sourcesMap.keys()));\r\n\r\n                // Priority: Vidlink (HLS/Embed) -> Torrent -> Consumet\r\n                const vidlink = sourcesMap.get('vidlink');\r\n                const torrent = sourcesMap.get('torrent');\r\n\r\n                console.log(\"[WatchPage] Vidlink sources:\", vidlink);\r\n                console.log(\"[WatchPage] Torrent sources:\", torrent);\r\n\r\n                if (vidlink && vidlink.length > 0) {\r\n                    bestSourceObj = vidlink[0];\r\n                } else if (torrent && torrent.length > 0) {\r\n                    bestSourceObj = torrent[0]; // Streaming torrent URL\r\n                } else {\r\n                    console.warn(\"[WatchPage] No sources found in map.\");\r\n                    setError(\"No playable sources found\");\r\n                }\r\n\r\n                if (bestSourceObj) {\r\n                    setSourceUrl(bestSourceObj.url);\r\n                    setIsEmbed(bestSourceObj.type === 'embed');\r\n                }\r\n\r\n            } catch (err: any) {\r\n                console.error(\"Watch page error:\", err);\r\n                if (mounted) setError(err.message || \"Failed to load content\");\r\n            } finally {\r\n                if (mounted) setLoading(false);\r\n            }\r\n        }\r\n\r\n        if (id) {\r\n            loadData();\r\n        }\r\n\r\n        return () => { mounted = false; };\r\n    }, [id, type]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex h-screen w-full items-center justify-center bg-black\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                    <Loader2 className=\"h-10 w-10 animate-spin text-red-600\" />\r\n                    <p className=\"text-zinc-400 font-medium animate-pulse\">Locating stream...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error || !content) {\r\n        return (\r\n            <div className=\"flex h-screen w-full items-center justify-center bg-black\">\r\n                <div className=\"text-center space-y-4 max-w-md px-6\">\r\n                    <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto\" />\r\n                    <h2 className=\"text-2xl font-bold text-white\">Playback Error</h2>\r\n                    <p className=\"text-zinc-400\">{error || \"Unknown error occurred\"}</p>\r\n                    <Button onClick={() => router.back()} variant=\"secondary\">\r\n                        <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n                        Go Back\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative h-screen w-full bg-black overflow-hidden flex flex-col\">\r\n            {/* Top Bar / Navigation Overlay */}\r\n            <div className={`absolute top-0 left-0 w-full z-20 p-6 bg-gradient-to-b from-black/80 to-transparent flex items-center justify-between pointer-events-none transition-opacity duration-300 ${isEmbed ? 'hover:opacity-100 opacity-0' : 'opacity-100'}`}>\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    className=\"pointer-events-auto hover:bg-white/10 text-white\"\r\n                    onClick={() => router.back()}\r\n                >\r\n                    <ArrowLeft className=\"mr-2 h-5 w-5\" />\r\n                    Back\r\n                </Button>\r\n\r\n                <div className=\"text-right\">\r\n                    <h1 className=\"text-lg font-bold text-white drop-shadow-md\">{content.title}</h1>\r\n                    {type === 'tv' && <p className=\"text-sm text-zinc-300\">Season 1 â€¢ Episode 1</p>}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Player Container */}\r\n            <div className=\"flex-1 flex items-center justify-center bg-black\">\r\n                {sourceUrl ? (\r\n                    isEmbed ? (\r\n                        <WebviewPlayer\r\n                            src={sourceUrl}\r\n                            title={content.title}\r\n                            onStateUpdate={(state) => {\r\n                                console.log(\"[WatchPage] Webview State Update:\", state);\r\n                            }}\r\n                        />\r\n                    ) : (\r\n                        <div className=\"w-full h-full max-w-[1920px]\">\r\n                            <VideoPlayer\r\n                                src={sourceUrl}\r\n                                poster={content.backdrop || content.poster}\r\n                                title={content.title}\r\n                                onEnded={() => { console.log(\"Video ended\"); }}\r\n                            />\r\n                        </div>\r\n                    )\r\n                ) : (\r\n                    <div className=\"text-zinc-500\">Source URL missing</div>\r\n                )}\r\n\r\n                {/* Debug Overlay */}\r\n                <div className=\"absolute bottom-4 left-4 z-50 p-2 bg-black/80 text-xs text-green-400 font-mono rounded pointer-events-none select-text\">\r\n                    <p>Status: {loading ? 'Loading' : 'Ready'}</p>\r\n                    <p>Type: {type}</p>\r\n                    <p>Embed Mode: {isEmbed ? 'YES' : 'NO'}</p>\r\n                    <p>Source: {sourceUrl || 'None'}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}