{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/api/content.ts"],"sourcesContent":["import axios from \"axios\";\r\nimport { Content } from \"@/lib/types/content\";\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000/api\";\r\n\r\nexport const contentApi = {\r\n    getTrending: async (): Promise<Content[]> => {\r\n        try {\r\n            // Randomize page 1-3 to ensure freshness on reload\r\n            const randomPage = Math.floor(Math.random() * 3) + 1;\r\n            const res = await axios.get(`/tmdb-api/trending/all/day?language=en-US&page=${randomPage}`);\r\n            const data = res.data.results || [];\r\n            return data.map(transformToContent).sort(() => Math.random() - 0.5); // Shuffle results\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch trending:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getPopularTV: async (): Promise<Content[]> => {\r\n        try {\r\n            const randomPage = Math.floor(Math.random() * 5) + 1;\r\n            // Exclude anime (210024) from generic TV popular list\r\n            const res = await axios.get(`/tmdb-api/tv/popular?language=en-US&page=${randomPage}&without_keywords=210024`);\r\n            const data = res.data.results || [];\r\n            return data.map((item: any) => transformToContent({ ...item, type: 'tv' })).sort(() => Math.random() - 0.5);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch popular TV:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getByGenre: async (genreId: number, type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const randomPage = page || Math.floor(Math.random() * 5) + 1;\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : ''; // Filter anime from generic TV genres\r\n            const res = await axios.get(`${endpoint}?with_genres=${genreId}&language=en-US&page=${randomPage}&sort_by=popularity.desc${extraFilter}`);\r\n            const data = res.data.results || [];\r\n            return data.map((item: any) => transformToContent({ ...item, type })); // Preserving order for relevance unless specifically shuffled elsewhere\r\n        } catch (error) {\r\n            console.error(`Failed to fetch genre ${genreId}:`, error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    // --- Dynamic Categories (The Candy Store) ---\r\n\r\n    getAnime: async (page?: number): Promise<Content[]> => {\r\n        try {\r\n            const randomPage = page || Math.floor(Math.random() * 3) + 1;\r\n            // Discover TV with 'anime' keyword (210024) and Animation genre (16)\r\n            const res = await axios.get(`/tmdb-api/discover/tv?with_keywords=210024&with_genres=16&language=en-US&sort_by=popularity.desc&page=${randomPage}`);\r\n            const data = res.data.results || [];\r\n            return data.map((item: any) => transformToContent({ ...item, type: 'anime' }));\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch anime:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getBangers: async (type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const randomPage = page || 1;\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : '';\r\n            const res = await axios.get(`${endpoint}?sort_by=vote_average.desc&vote_count.gte=1000&language=en-US&page=${randomPage}${extraFilter}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getClassics: async (type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const randomPage = page || 1;\r\n            const dateFilter = type === 'movie' ? 'primary_release_date.lte=2010-01-01' : 'first_air_date.lte=2010-01-01';\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : '';\r\n            const res = await axios.get(`${endpoint}?sort_by=popularity.desc&vote_average.gte=7.5&${dateFilter}&language=en-US&page=${randomPage}${extraFilter}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getUnderrated: async (type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const randomPage = page || 1;\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : '';\r\n            const res = await axios.get(`${endpoint}?sort_by=vote_average.desc&vote_count.gte=200&vote_count.lte=2000&vote_average.gte=8.0&language=en-US&page=${randomPage}${extraFilter}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getFresh: async (type: 'movie' | 'tv' = 'movie', page?: number): Promise<Content[]> => {\r\n        try {\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const randomPage = page || 1;\r\n            const currentYear = new Date().getFullYear();\r\n            const dateFilter = type === 'movie' ? `primary_release_year=${currentYear}` : `first_air_date_year=${currentYear}`;\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : '';\r\n            const res = await axios.get(`${endpoint}?sort_by=popularity.desc&${dateFilter}&language=en-US&page=${randomPage}${extraFilter}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getRecommendations: async (id: string): Promise<Content[]> => {\r\n        try {\r\n            const cleanId = id.replace('tmdb_', '');\r\n            // We can't easily know the type from just ID here without lookup, but usually recommendations come from same type.\r\n            // Try movie first, if fail/empty try tv. Or better, pass type if possible.\r\n            // For now, let's assume we can get type or just try both.\r\n            // Actually, best is to ask the caller to provide valid context or just return empty if id invalid.\r\n            // Let's rely on the fact that we can often guess or duplicate.\r\n            // A safer bet: The history item SHOULD have the type. But if we only have ID...\r\n            // Optimization: The caller (Page) has the history item, so it knows the type.\r\n            // Let's update signature to take type.\r\n            return [];\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getSimilar: async (id: string, type: 'movie' | 'tv' | 'anime'): Promise<Content[]> => {\r\n        try {\r\n            // For Anime, we treat it as TV for TMDB queries usually\r\n            const queryType = type === 'anime' ? 'tv' : type;\r\n            const cleanId = id.replace('tmdb_', '');\r\n            const res = await axios.get(`/tmdb-api/${queryType}/${cleanId}/recommendations?language=en-US&page=1`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    // --- Anime Specific Categories ---\r\n    getAnimeByGenre: async (genreId: string, page?: number): Promise<Content[]> => { // genreId can be genre ID or keyword ID\r\n        try {\r\n            const randomPage = page || 1;\r\n            // 16 is Animation genre.\r\n            // Common Keywords:\r\n            // Isekai: 210024\r\n            // Mecha: 10701\r\n            // Dark Fantasy: 209252\r\n            // Slice of Life: 9840\r\n            // Sports: 6075\r\n            // Psychological: 9880 or genre 9648 (Mystery) + Animation\r\n\r\n            const res = await axios.get(`/tmdb-api/discover/tv?with_genres=16&${genreId}&language=en-US&sort_by=popularity.desc&page=${randomPage}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type: 'anime' }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getDayOneDrops: async (type: 'movie' | 'tv' = 'movie'): Promise<Content[]> => {\r\n        try {\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n\r\n            // Get date range for last 14 days (extended slightly from 7 for better results)\r\n            const today = new Date();\r\n            const pastDate = new Date();\r\n            pastDate.setDate(today.getDate() - 14);\r\n\r\n            const formatDate = (d: Date) => d.toISOString().split('T')[0];\r\n            const dateFilter = type === 'movie'\r\n                ? `primary_release_date.gte=${formatDate(pastDate)}&primary_release_date.lte=${formatDate(today)}`\r\n                : `first_air_date.gte=${formatDate(pastDate)}&first_air_date.lte=${formatDate(today)}`;\r\n\r\n            const extraFilter = type === 'tv' ? '&without_keywords=210024' : '';\r\n            const res = await axios.get(`${endpoint}?sort_by=popularity.desc&${dateFilter}&language=en-US&page=1${extraFilter}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    // Flexible discover for custom categories (A24, CBM, etc.)\r\n    discover: async (params: { with_companies?: string; with_keywords?: string; with_genres?: string; sort_by?: string; page?: number }, type: 'movie' | 'tv' = 'movie'): Promise<Content[]> => {\r\n        try {\r\n            const queryParams = new URLSearchParams({\r\n                language: 'en-US',\r\n                page: (params.page || Math.floor(Math.random() * 3) + 1).toString(),\r\n                sort_by: params.sort_by || 'popularity.desc',\r\n                ...params\r\n            } as any);\r\n\r\n            const endpoint = type === 'movie' ? '/tmdb-api/discover/movie' : '/tmdb-api/discover/tv';\r\n            const res = await axios.get(`${endpoint}?${queryParams.toString()}`);\r\n            return (res.data.results || []).map((item: any) => transformToContent({ ...item, type }));\r\n        } catch (error) {\r\n            console.error(\"Failed to discover content:\", error);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    getTrailer: async (id: string, type: 'movie' | 'tv' = 'movie'): Promise<string | null> => {\r\n        try {\r\n            const cleanId = id.replace('tmdb_', '');\r\n            const res = await axios.get(`/tmdb-api/${type}/${cleanId}/videos?language=en-US`);\r\n            const videos = res.data.results || [];\r\n            const trailer = videos.find((v: any) => v.type === \"Trailer\" && v.site === \"YouTube\") || videos[0];\r\n            return trailer ? trailer.key : null;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    },\r\n\r\n    getDetails: async (id: string | number, type: 'movie' | 'tv' = 'movie'): Promise<Content | null> => {\r\n        try {\r\n            // Ensure ID is a string\r\n            const idStr = String(id);\r\n            // Strip 'tmdb_' prefix if present\r\n            const cleanId = idStr.replace('tmdb_', '');\r\n\r\n            const endpoint = `/tmdb-api/${type}/${cleanId}?language=en-US&append_to_response=credits,recommendations,videos`;\r\n            const res = await axios.get(endpoint);\r\n            return transformToContent({ ...res.data, type });\r\n        } catch (error) {\r\n            console.error(`Failed to fetch ${type} details for ${id}:`, error);\r\n            return null;\r\n        }\r\n    },\r\n\r\n    getSeasonDetails: async (id: string | number, seasonNumber: number): Promise<any> => {\r\n        try {\r\n            const idStr = String(id).replace('tmdb_', '');\r\n            const res = await axios.get(`/tmdb-api/tv/${idStr}/season/${seasonNumber}?language=en-US`);\r\n            return res.data;\r\n        } catch (error) {\r\n            console.error(`Failed to fetch season ${seasonNumber} for ${id}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n};\r\n\r\nconst transformToContent = (item: any): Content => {\r\n    // Helper to extract path and ensure w500/original prefix for the proxy\r\n    const getProxyUrl = (tmdbPath: string | null, fallbackUrl: string | null, size: string, fallbackAsset: string) => {\r\n        if (tmdbPath) {\r\n            // Ensure path is clean (remove leading slash if it exists, proxy adds it)\r\n            const cleanPath = tmdbPath.startsWith('/') ? tmdbPath.substring(1) : tmdbPath;\r\n            return `/tmdb-img/${size}/${cleanPath}`;\r\n        }\r\n        if (fallbackUrl && fallbackUrl.includes('tmdb.org')) {\r\n            const parts = fallbackUrl.split('/t/p/');\r\n            if (parts[1]) return `/tmdb-img/${parts[1]}`;\r\n        }\r\n        return fallbackUrl || fallbackAsset;\r\n    };\r\n\r\n    return {\r\n        id: String(item._id || item.id || `tmdb_${item.tmdbId}`),\r\n        title: item.title || item.name || \"Unknown Title\",\r\n        description: item.description || item.overview || \"\",\r\n        poster: getProxyUrl(item.poster_path, item.posterUrl, 'w500', \"/images/placeholder.png\"),\r\n        backdrop: getProxyUrl(item.backdrop_path, item.backdropUrl, 'original', \"/images/hero_placeholder.jpg\"),\r\n        rating: item.rating || item.vote_average || 0,\r\n        releaseDate: item.year || item.release_date || item.first_air_date || \"2024\",\r\n        type: (item.type || item.media_type || \"movie\") as 'movie' | 'tv' | 'anime',\r\n        genres: (item.genres || []).map((g: any) => typeof g === 'object' ? g.name : g),\r\n        status: 'ongoing',\r\n        isAdult: false,\r\n        seasonsList: item.seasons?.map((s: any) => ({\r\n            id: s.id,\r\n            season_number: s.season_number,\r\n            episode_count: s.episode_count,\r\n            name: s.name\r\n        })) || [],\r\n        cast: item.credits?.cast?.slice(0, 10).map((c: any) => ({\r\n            id: c.id,\r\n            name: c.name,\r\n            character: c.character,\r\n            profilePath: c.profile_path ? `/tmdb-img/w185/${c.profile_path}` : null\r\n        })) || [],\r\n        recommendations: item.recommendations?.results?.slice(0, 5).map((r: any) => transformToContent({ ...r, type: r.media_type || item.type || 'movie' })) || [],\r\n        trailer: item.videos?.results?.find((v: any) => v.type === \"Trailer\" && v.site === \"YouTube\")?.key || null\r\n    };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/services/sourceProvider.ts"],"sourcesContent":["interface StreamSource {\r\n    url: string;\r\n    quality: string;\r\n    type: 'hls' | 'mp4' | 'torrent' | 'embed';\r\n}\r\n\r\ninterface ContentItem {\r\n    id: string;\r\n    title: string;\r\n    type: 'anime' | 'movie' | 'series';\r\n}\r\n\r\nclass SourceProvider {\r\n    private consumetAPI = 'https://api.consumet.org';\r\n    private cache: Map<string, Map<string, StreamSource[]>> = new Map();\r\n\r\n    async getSources(contentId: string, type: 'movie' | 'series' | 'anime', title: string): Promise<StreamSource[]> {\r\n        try {\r\n            console.log(`[SourceProvider] Fetching: /api/sources?id=${contentId}&type=${type}&title=${title}`);\r\n            const response = await fetch(`/api/sources?id=${contentId}&type=${type}&title=${encodeURIComponent(title)}`);\r\n            if (!response.ok) {\r\n                console.error(\"[SourceProvider] API error:\", response.status, response.statusText);\r\n                return [];\r\n            }\r\n            const data = await response.json();\r\n            console.log(\"[SourceProvider] Raw API Data:\", data);\r\n            return data.sources || [];\r\n        } catch (error) {\r\n            console.error('Source fetch error:', error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    async getAllSources(\r\n        content: ContentItem,\r\n        season: number = 1,\r\n        episode: number = 1\r\n    ): Promise<Map<string, StreamSource[]>> {\r\n        const cacheKey = `${content.type}:${content.id}:${season}:${episode}`;\r\n        if (this.cache.has(cacheKey)) {\r\n            return this.cache.get(cacheKey)!;\r\n        }\r\n\r\n        const sources = new Map<string, StreamSource[]>();\r\n\r\n        // Single call to backend which handles aggregator logic (Vidlink + Torrent + etc)\r\n        const url = `/api/sources?id=${content.id}&type=${content.type}&title=${encodeURIComponent(content.title)}&season=${season}&episode=${episode}`;\r\n        console.log(`[SourceProvider] Fetching: ${url}`);\r\n\r\n        try {\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                console.error(\"[SourceProvider] API error:\", response.status, response.statusText);\r\n                return sources;\r\n            }\r\n            const data = await response.json();\r\n            const allSources = data.sources || [];\r\n\r\n\r\n            if (allSources.length > 0) {\r\n                // Group by type for the UI\r\n                const vidlink = allSources.filter((s: any) => s.type === 'hls' || s.type === 'embed');\r\n                const torrent = allSources.filter((s: any) => s.type === 'torrent' || s.type === 'mp4');\r\n\r\n                if (vidlink.length > 0) sources.set('vidlink', vidlink);\r\n                if (torrent.length > 0) sources.set('torrent', torrent);\r\n            }\r\n\r\n            this.cache.set(cacheKey, sources);\r\n            return sources;\r\n        } catch (error) {\r\n            console.error('Source fetch error:', error);\r\n            return sources;\r\n        }\r\n    }\r\n\r\n    clearCache() {\r\n        this.cache.clear();\r\n    }\r\n}\r\n\r\nconst sourceProvider = new SourceProvider();\r\nexport default sourceProvider;\r\n"],"names":[],"mappings":";;;;AAYA,MAAM;IACM,cAAc,2BAA2B;IACzC,QAAkD,IAAI,MAAM;IAEpE,MAAM,WAAW,SAAiB,EAAE,IAAkC,EAAE,KAAa,EAA2B;QAC5G,IAAI;YACA,QAAQ,GAAG,CAAC,CAAC,2CAA2C,EAAE,UAAU,MAAM,EAAE,KAAK,OAAO,EAAE,OAAO;YACjG,MAAM,WAAW,MAAM,MAAM,CAAC,gBAAgB,EAAE,UAAU,MAAM,EAAE,KAAK,OAAO,EAAE,mBAAmB,QAAQ;YAC3G,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,QAAQ,KAAK,CAAC,+BAA+B,SAAS,MAAM,EAAE,SAAS,UAAU;gBACjF,OAAO,EAAE;YACb;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,kCAAkC;YAC9C,OAAO,KAAK,OAAO,IAAI,EAAE;QAC7B,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,EAAE;QACb;IACJ;IAEA,MAAM,cACF,OAAoB,EACpB,SAAiB,CAAC,EAClB,UAAkB,CAAC,EACiB;QACpC,MAAM,WAAW,GAAG,QAAQ,IAAI,CAAC,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,SAAS;QACrE,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW;YAC1B,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;QAC1B;QAEA,MAAM,UAAU,IAAI;QAEpB,kFAAkF;QAClF,MAAM,MAAM,CAAC,gBAAgB,EAAE,QAAQ,EAAE,CAAC,MAAM,EAAE,QAAQ,IAAI,CAAC,OAAO,EAAE,mBAAmB,QAAQ,KAAK,EAAE,QAAQ,EAAE,OAAO,SAAS,EAAE,SAAS;QAC/I,QAAQ,GAAG,CAAC,CAAC,2BAA2B,EAAE,KAAK;QAE/C,IAAI;YACA,MAAM,WAAW,MAAM,MAAM;YAC7B,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,QAAQ,KAAK,CAAC,+BAA+B,SAAS,MAAM,EAAE,SAAS,UAAU;gBACjF,OAAO;YACX;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,MAAM,aAAa,KAAK,OAAO,IAAI,EAAE;YAGrC,IAAI,WAAW,MAAM,GAAG,GAAG;gBACvB,2BAA2B;gBAC3B,MAAM,UAAU,WAAW,MAAM,CAAC,CAAC,IAAW,EAAE,IAAI,KAAK,SAAS,EAAE,IAAI,KAAK;gBAC7E,MAAM,UAAU,WAAW,MAAM,CAAC,CAAC,IAAW,EAAE,IAAI,KAAK,aAAa,EAAE,IAAI,KAAK;gBAEjF,IAAI,QAAQ,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,WAAW;gBAC/C,IAAI,QAAQ,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,WAAW;YACnD;YAEA,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU;YACzB,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO;QACX;IACJ;IAEA,aAAa;QACT,IAAI,CAAC,KAAK,CAAC,KAAK;IACpB;AACJ;AAEA,MAAM,iBAAiB,IAAI;uCACZ"}},
    {"offset": {"line": 379, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/store/playerStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\n\r\ninterface PlayerState {\r\n    isPlaying: boolean;\r\n    volume: number;\r\n    muted: boolean;\r\n    currentTime: number;\r\n    duration: number;\r\n    playbackRate: number;\r\n    quality: string;\r\n    isFullscreen: boolean;\r\n    showControls: boolean;\r\n\r\n    // Actions\r\n    setPlaying: (playing: boolean) => void;\r\n    setVolume: (volume: number) => void;\r\n    setMuted: (muted: boolean) => void;\r\n    setCurrentTime: (time: number) => void;\r\n    setDuration: (duration: number) => void;\r\n    setPlaybackRate: (rate: number) => void;\r\n    setQuality: (quality: string) => void;\r\n    setFullscreen: (fullscreen: boolean) => void;\r\n    setShowControls: (show: boolean) => void;\r\n    reset: () => void;\r\n}\r\n\r\nexport const usePlayerStore = create<PlayerState>()(\r\n    persist(\r\n        (set) => ({\r\n            isPlaying: false,\r\n            volume: 1,\r\n            muted: false,\r\n            currentTime: 0,\r\n            duration: 0,\r\n            playbackRate: 1,\r\n            quality: 'auto',\r\n            isFullscreen: false,\r\n            showControls: true,\r\n\r\n            setPlaying: (isPlaying) => set({ isPlaying }),\r\n            setVolume: (volume) => set({ volume }),\r\n            setMuted: (muted) => set({ muted }),\r\n            setCurrentTime: (currentTime) => set({ currentTime }),\r\n            setDuration: (duration) => set({ duration }),\r\n            setPlaybackRate: (playbackRate) => set({ playbackRate }),\r\n            setQuality: (quality) => set({ quality }),\r\n            setFullscreen: (isFullscreen) => set({ isFullscreen }),\r\n            setShowControls: (showControls) => set({ showControls }),\r\n            reset: () => set({\r\n                isPlaying: false,\r\n                currentTime: 0,\r\n                duration: 0,\r\n                isFullscreen: false,\r\n                showControls: true\r\n            })\r\n        }),\r\n        {\r\n            name: 'novastream-player-storage',\r\n            partialize: (state) => ({\r\n                volume: state.volume,\r\n                muted: state.muted,\r\n                quality: state.quality,\r\n                playbackRate: state.playbackRate\r\n            }),\r\n        }\r\n    )\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AA0BO,MAAM,iBAAiB,IAAA,qJAAM,IAChC,IAAA,2JAAO,EACH,CAAC,MAAQ,CAAC;QACN,WAAW;QACX,QAAQ;QACR,OAAO;QACP,aAAa;QACb,UAAU;QACV,cAAc;QACd,SAAS;QACT,cAAc;QACd,cAAc;QAEd,YAAY,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC3C,WAAW,CAAC,SAAW,IAAI;gBAAE;YAAO;QACpC,UAAU,CAAC,QAAU,IAAI;gBAAE;YAAM;QACjC,gBAAgB,CAAC,cAAgB,IAAI;gBAAE;YAAY;QACnD,aAAa,CAAC,WAAa,IAAI;gBAAE;YAAS;QAC1C,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,YAAY,CAAC,UAAY,IAAI;gBAAE;YAAQ;QACvC,eAAe,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACpD,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,OAAO,IAAM,IAAI;gBACb,WAAW;gBACX,aAAa;gBACb,UAAU;gBACV,cAAc;gBACd,cAAc;YAClB;IACJ,CAAC,GACD;IACI,MAAM;IACN,YAAY,CAAC,QAAU,CAAC;YACpB,QAAQ,MAAM,MAAM;YACpB,OAAO,MAAM,KAAK;YAClB,SAAS,MAAM,OAAO;YACtB,cAAc,MAAM,YAAY;QACpC,CAAC;AACL"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/store/historyStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { Content } from '@/lib/types/content';\r\n\r\ninterface HistoryState {\r\n    history: Content[];\r\n    addToHistory: (content: Content) => void;\r\n    clearHistory: () => void;\r\n    getLastWatched: () => Content | undefined;\r\n}\r\n\r\nexport const useHistoryStore = create<HistoryState>()(\r\n    persist(\r\n        (set, get) => ({\r\n            history: [],\r\n            addToHistory: (content) => set((state) => {\r\n                // Remove if already exists to move to top\r\n                const filtered = state.history.filter(i => i.id !== content.id);\r\n                // Keep only last 20\r\n                return { history: [content, ...filtered].slice(0, 20) };\r\n            }),\r\n            clearHistory: () => set({ history: [] }),\r\n            getLastWatched: () => get().history[0]\r\n        }),\r\n        {\r\n            name: 'novastream-history-storage',\r\n        }\r\n    )\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAUO,MAAM,kBAAkB,IAAA,qJAAM,IACjC,IAAA,2JAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,SAAS,EAAE;QACX,cAAc,CAAC,UAAY,IAAI,CAAC;gBAC5B,0CAA0C;gBAC1C,MAAM,WAAW,MAAM,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE;gBAC9D,oBAAoB;gBACpB,OAAO;oBAAE,SAAS;wBAAC;2BAAY;qBAAS,CAAC,KAAK,CAAC,GAAG;gBAAI;YAC1D;QACA,cAAc,IAAM,IAAI;gBAAE,SAAS,EAAE;YAAC;QACtC,gBAAgB,IAAM,MAAM,OAAO,CAAC,EAAE;IAC1C,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 482, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/VideoPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { MediaPlayer, MediaProvider, Poster, Track } from '@vidstack/react';\r\nimport type { MediaPlayerInstance } from '@vidstack/react';\r\nimport '@vidstack/react/player/styles/default/theme.css';\r\nimport '@vidstack/react/player/styles/default/layouts/video.css';\r\nimport { DefaultVideoLayout, defaultLayoutIcons } from '@vidstack/react/player/layouts/default';\r\nimport { usePlayerStore } from '@/lib/store/playerStore';\r\n\r\ninterface VideoPlayerProps {\r\n    src: string;\r\n    poster?: string;\r\n    title?: string;\r\n    subtitles?: { kind: string; src: string; label: string; language: string; default?: boolean }[];\r\n    onEnded?: () => void;\r\n}\r\n\r\nexport function VideoPlayer({ src, poster, title, subtitles, onEnded }: VideoPlayerProps) {\r\n    const player = useRef<MediaPlayerInstance>(null);\r\n    const {\r\n        setPlaying,\r\n        setDuration,\r\n        setCurrentTime,\r\n        setVolume,\r\n        setMuted,\r\n        setFullscreen\r\n    } = usePlayerStore();\r\n\r\n    useEffect(() => {\r\n        // Sync state with store\r\n        const instance = player.current;\r\n        if (!instance) return;\r\n\r\n        return instance.subscribe((state) => {\r\n            setPlaying(state.playing);\r\n            setDuration(state.duration);\r\n            setCurrentTime(state.currentTime);\r\n            setVolume(state.volume);\r\n            setMuted(state.muted);\r\n            setFullscreen(state.fullscreen);\r\n\r\n            if (state.ended) onEnded?.();\r\n        });\r\n    }, [src, onEnded, setPlaying, setDuration, setCurrentTime, setVolume, setMuted, setFullscreen]);\r\n\r\n    return (\r\n        <div className=\"relative w-full aspect-video bg-black rounded-xl overflow-hidden ring-1 ring-white/10 shadow-2xl\">\r\n            <MediaPlayer\r\n                ref={player}\r\n                title={title}\r\n                src={src}\r\n                className=\"w-full h-full\"\r\n                aspectRatio=\"16/9\"\r\n                load=\"eager\"\r\n                poster={poster}\r\n            >\r\n                <MediaProvider>\r\n                    <Poster className=\"vds-poster\" />\r\n                    {subtitles?.map((track, i) => (\r\n                        <Track key={i} {...track} kind=\"subtitles\" />\r\n                    ))}\r\n                </MediaProvider>\r\n\r\n                {/* \r\n                  Using Default Layout for now. \r\n                  In Phase 4 (Custom Controls), we can replace this with our own UI \r\n                  using Radix/manual controls if desired, but Vidstack's default is very premium customization friendly.\r\n                */}\r\n                <DefaultVideoLayout icons={defaultLayoutIcons} />\r\n            </MediaPlayer>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAIA;AAAA;AACA;;;AARA;;;;;;;AAkBO,SAAS,YAAY,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAoB;;IACpF,MAAM,SAAS,IAAA,uKAAM,EAAsB;IAC3C,MAAM,EACF,UAAU,EACV,WAAW,EACX,cAAc,EACd,SAAS,EACT,QAAQ,EACR,aAAa,EAChB,GAAG,IAAA,uJAAc;IAElB,IAAA,0KAAS;iCAAC;YACN,wBAAwB;YACxB,MAAM,WAAW,OAAO,OAAO;YAC/B,IAAI,CAAC,UAAU;YAEf,OAAO,SAAS,SAAS;yCAAC,CAAC;oBACvB,WAAW,MAAM,OAAO;oBACxB,YAAY,MAAM,QAAQ;oBAC1B,eAAe,MAAM,WAAW;oBAChC,UAAU,MAAM,MAAM;oBACtB,SAAS,MAAM,KAAK;oBACpB,cAAc,MAAM,UAAU;oBAE9B,IAAI,MAAM,KAAK,EAAE;gBACrB;;QACJ;gCAAG;QAAC;QAAK;QAAS;QAAY;QAAa;QAAgB;QAAW;QAAU;KAAc;IAE9F,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC,wLAAW;YACR,KAAK;YACL,OAAO;YACP,KAAK;YACL,WAAU;YACV,aAAY;YACZ,MAAK;YACL,QAAQ;;8BAER,6LAAC,0LAAa;;sCACV,6LAAC,mLAAM;4BAAC,WAAU;;;;;;wBACjB,WAAW,IAAI,CAAC,OAAO,kBACpB,6LAAC,kLAAK;gCAAU,GAAG,KAAK;gCAAE,MAAK;+BAAnB;;;;;;;;;;;8BASpB,6LAAC,qMAAkB;oBAAC,OAAO,6MAAkB;;;;;;;;;;;;;;;;;AAI7D;GAvDgB;;QASR,uJAAc;;;KATN"}},
    {"offset": {"line": 600, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/overlay/PlayerControls.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react';\r\nimport { ArrowLeft, BookHeart, Heart, Download, ChevronLeft, ChevronRight, Volume2, VolumeX, Play, Pause, PictureInPicture, Zap, Maximize, Settings } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\n// Local Helper\r\nconst formatTimeLocal = (seconds: number) => {\r\n    if (!seconds) return \"0:00\";\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;\r\n};\r\n\r\ninterface PlayerControlsProps {\r\n    show: boolean;\r\n    title: string;\r\n    subTitle?: string;\r\n    backUrl?: string; // Explicit back path override\r\n    currentTime: number;\r\n    duration: number;\r\n    isPaused: boolean;\r\n    volume: number;\r\n    isMuted: boolean;\r\n    isSaved: boolean;\r\n    downloadUrl: string | null;\r\n    isSeeking: boolean;\r\n    seekValue: number;\r\n\r\n    // Series Specific\r\n    type: 'movie' | 'tv' | 'local' | 'torrent';\r\n    isTorrent?: boolean;\r\n    season: string;\r\n    episode: string;\r\n    seasons?: any[];\r\n\r\n    // Actions\r\n    onTogglePlay: () => void;\r\n    onSeekChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n    onSeekCommit: () => void;\r\n    onVolumeChange: (volume: number) => void;\r\n    onToggleMute: () => void;\r\n    onToggleLibrary: () => void;\r\n    onDownload: () => void;\r\n    onToggleSettings: () => void;\r\n    onTogglePiP: () => void;\r\n    onNext?: () => void;\r\n    onPrev?: () => void;\r\n    onSeasonChange?: (s: number) => void;\r\n    onEpisodeChange?: (e: string) => void;\r\n    onStartOver?: () => void;\r\n    onToggleFullscreen: () => void;\r\n\r\n    // Debug / State\r\n    providerType?: string;\r\n    tracks?: any[];\r\n    audioTracks?: any[];\r\n    qualities?: any[];\r\n}\r\n\r\nexport default function PlayerControls({\r\n    show, title, subTitle, backUrl, currentTime, duration, isPaused, volume, isMuted, isSaved, downloadUrl,\r\n    isSeeking, seekValue, type, isTorrent, season, episode, seasons,\r\n    onTogglePlay, onSeekChange, onSeekCommit, onVolumeChange, onToggleMute,\r\n    onToggleLibrary, onDownload, onToggleSettings, onTogglePiP,\r\n    onNext, onPrev, onSeasonChange, onEpisodeChange, onToggleFullscreen,\r\n    ...props // Capture debug props\r\n}: PlayerControlsProps) {\r\n\r\n    const router = useRouter();\r\n    const currentSeasonNum = parseInt(season);\r\n    const currentEpisodeNum = parseInt(episode);\r\n\r\n    const safeDuration = Number.isFinite(duration) && duration > 0 ? duration : 0;\r\n    const safeTime = Number.isFinite(currentTime) && currentTime >= 0 ? currentTime : 0;\r\n    const displayTime = isSeeking ? seekValue : safeTime;\r\n\r\n    const handleBack = () => {\r\n        if (backUrl) {\r\n            router.push(backUrl);\r\n        } else {\r\n            router.push('/');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`absolute inset-0 z-[60] flex flex-col justify-between transition-opacity duration-300 pointer-events-none ${show ? 'opacity-100' : 'opacity-0'}`}>\r\n\r\n            {/* --- TOP BAR --- */}\r\n            <div className={`pointer-events-auto bg-gradient-to-b from-black via-black/90 to-transparent p-6 pb-20 flex justify-between items-start transition-transform duration-300 ${show ? 'translate-y-0' : '-translate-y-full'}`}>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button onClick={handleBack} aria-label=\"Go back\" className=\"p-2 bg-white/10 rounded-full hover:bg-white/20 text-white backdrop-blur-md\">\r\n                        <ArrowLeft size={24} aria-hidden=\"true\" />\r\n                    </button>\r\n                    <div className=\"flex flex-col text-shadow\">\r\n                        <span className=\"text-white font-bold text-lg\">{title}</span>\r\n                        {subTitle && <span className=\"text-white/60 text-xs font-medium\">{subTitle}</span>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Side Icons */}\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* Torrent Indicator Badge */}\r\n                    {(type === 'torrent' || isTorrent) && (\r\n                        <div className=\"flex items-center justify-center w-10 h-10 bg-purple-600/30 backdrop-blur-sm rounded-full border border-purple-400/30 shadow-[0_0_15px_rgba(147,51,234,0.3)] animate-pulse\">\r\n                            <Zap size={20} className=\"text-purple-300 drop-shadow-[0_0_5px_rgba(147,51,234,0.8)]\" fill=\"currentColor\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <button onClick={onToggleLibrary} aria-label={isSaved ? \"Remove from Library\" : \"Add to Library\"} className={`p-2.5 rounded-full backdrop-blur-md transition-all ${isSaved ? 'bg-purple-600/80 text-white' : 'bg-white/10 text-white/60 hover:text-white'}`}>\r\n                        {isSaved ? <BookHeart size={20} aria-hidden=\"true\" /> : <Heart size={20} aria-hidden=\"true\" />}\r\n                    </button>\r\n                    {/* Download Button */}\r\n                    <button\r\n                        disabled={!downloadUrl}\r\n                        onClick={onDownload}\r\n                        aria-label=\"Download video\"\r\n                        className={`p-2.5 rounded-full backdrop-blur-md transition-all ${downloadUrl ? 'bg-white/10 text-white/60 hover:text-white hover:bg-white/20' : 'bg-white/5 text-white/20 cursor-not-allowed'}`}\r\n                        title={downloadUrl ? \"Download\" : \"Waiting for stream...\"}\r\n                    >\r\n                        <Download size={20} aria-hidden=\"true\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* DEBUG OVERLAY - REMOVE BEFORE PROD */}\r\n            <div className=\"absolute top-20 left-6 bg-black/80 p-2 rounded text-[10px] text-green-400 font-mono pointer-events-none z-50\">\r\n                <p>PROV: {props.providerType || 'N/A'}</p>\r\n                <p>AUD: {props.audioTracks?.length || 0}</p>\r\n                <p>SUB: {props.tracks?.length || 0}</p>\r\n                <p>QUAL: {props.qualities?.length || 0}</p>\r\n            </div>\r\n\r\n            {/* --- BOTTOM CONTROLS --- */}\r\n            <div className={`pointer-events-auto bg-gradient-to-t from-black via-black/95 to-transparent pt-40 pb-8 px-6 transition-transform duration-300 ${show ? 'translate-y-0' : 'translate-y-full'}`}>\r\n\r\n                {/* Progress Bar */}\r\n                <div className=\"flex items-center gap-3 mb-4 group/progress\">\r\n                    <span className=\"text-xs font-medium text-white/80 w-10 text-right\">{formatTimeLocal(displayTime)}</span>\r\n                    <input\r\n                        type=\"range\"\r\n                        min={0}\r\n                        max={safeDuration || 100}\r\n                        value={Math.min(displayTime, safeDuration || 100)}\r\n                        step={0.1}\r\n                        onChange={onSeekChange}\r\n                        onMouseUp={onSeekCommit}\r\n                        onTouchEnd={onSeekCommit} // For mobile\r\n                        aria-label=\"Seek slider\"\r\n                        className=\"flex-1 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-purple-500 [&::-webkit-slider-thumb]:rounded-full hover:[&::-webkit-slider-thumb]:scale-125 transition-all\"\r\n                    />\r\n                    <span className=\"text-xs font-medium text-white/60 w-10\">{formatTimeLocal(safeDuration)}</span>\r\n                </div>\r\n\r\n                {/* Main Button Row */}\r\n                <div className=\"flex items-center justify-between\">\r\n\r\n                    <div className=\"flex items-center gap-6\">\r\n                        {/* Play/Pause */}\r\n                        <button onClick={onTogglePlay} aria-label={isPaused ? \"Play\" : \"Pause\"} className=\"p-2 hover:bg-white/10 rounded-full text-white transition-colors\">\r\n                            {isPaused ? <Play size={32} fill=\"currentColor\" aria-hidden=\"true\" /> : <Pause size={32} fill=\"currentColor\" aria-hidden=\"true\" />}\r\n                        </button>\r\n\r\n                        {/* Volume */}\r\n                        <div className=\"flex items-center gap-2 group/vol\">\r\n                            <button onClick={onToggleMute} aria-label={isMuted ? \"Unmute\" : \"Mute\"} className=\"text-white/80 hover:text-white\">\r\n                                {volume === 0 ? <VolumeX size={24} aria-hidden=\"true\" /> : <Volume2 size={24} aria-hidden=\"true\" />}\r\n                            </button>\r\n                            <div className=\"w-0 overflow-hidden group-hover/vol:w-24 transition-all duration-300\">\r\n                                <input\r\n                                    type=\"range\"\r\n                                    min={0}\r\n                                    max={2.5}\r\n                                    step={0.1}\r\n                                    value={isMuted ? 0 : volume}\r\n                                    onChange={(e) => {\r\n                                        const newVolume = parseFloat(e.target.value);\r\n                                        onVolumeChange(newVolume);\r\n                                        if (isMuted && newVolume > 0) {\r\n                                            onToggleMute();\r\n                                        }\r\n                                    }}\r\n                                    className=\"w-20 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer ml-2 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2 [&::-webkit-slider-thumb]:h-2 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* TV SERIES NAVIGATION */}\r\n                        {type === 'tv' && seasons && (\r\n                            <div className=\"flex items-center gap-2 ml-4\">\r\n                                <button onClick={onPrev} aria-label=\"Previous episode\" className=\"p-1.5 hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors\" disabled={currentSeasonNum === 1 && currentEpisodeNum === 1}>\r\n                                    <ChevronLeft size={20} aria-hidden=\"true\" />\r\n                                </button>\r\n\r\n                                <div className=\"flex items-center gap-0 bg-white/10 rounded-md border border-white/5 overflow-hidden\">\r\n                                    <select\r\n                                        className=\"bg-transparent text-white font-bold text-xs outline-none cursor-pointer hover:bg-white/5 px-2 py-1.5 appearance-none text-center min-w-[3rem]\"\r\n                                        value={currentSeasonNum}\r\n                                        aria-label=\"Select Season\"\r\n                                        onChange={(e) => onSeasonChange && onSeasonChange(Number(e.target.value))}\r\n                                    >\r\n                                        {seasons.filter((s: any) => s.season_number > 0).map((s: any) => (\r\n                                            <option key={s.id} value={s.season_number} className=\"bg-zinc-900 text-left\">S{s.season_number}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                    <div className=\"w-[1px] h-4 bg-white/10\" />\r\n                                    <select\r\n                                        className=\"bg-transparent text-white font-bold text-xs outline-none cursor-pointer hover:bg-white/5 px-2 py-1.5 appearance-none text-center min-w-[3rem]\"\r\n                                        value={currentEpisodeNum}\r\n                                        aria-label=\"Select Episode\"\r\n                                        onChange={(e) => onEpisodeChange && onEpisodeChange(e.target.value)}\r\n                                    >\r\n                                        {(() => {\r\n                                            const seasonData = seasons.find((s: any) => s.season_number === currentSeasonNum);\r\n                                            const count = seasonData?.episode_count || 1;\r\n                                            return Array.from({ length: count }, (_, i) => i + 1).map(ep => (\r\n                                                <option key={ep} value={ep} className=\"bg-zinc-900 text-left\">E{ep}</option>\r\n                                            ));\r\n                                        })()}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <button onClick={onNext} aria-label=\"Next episode\" className=\"p-1.5 hover:bg-white/10 rounded-full text-white/70 hover:text-white transition-colors\">\r\n                                    <ChevronRight size={20} aria-hidden=\"true\" />\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Right Side Controls (Settings, PiP & Fullscreen) */}\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {/* Settings Button (Languages/Quality) */}\r\n                        <button\r\n                            onClick={onToggleSettings}\r\n                            aria-label=\"Settings\"\r\n                            className=\"p-2 rounded-full transition-colors text-white/70 hover:text-white\"\r\n                            title=\"Settings (Audio & Subtitles)\"\r\n                        >\r\n                            <Settings size={20} aria-hidden=\"true\" />\r\n                        </button>\r\n\r\n                        {/* PiP Button */}\r\n                        <button\r\n                            onClick={onTogglePiP}\r\n                            aria-label=\"Toggle Picture in Picture\"\r\n                            className=\"p-2 rounded-full transition-colors text-white/70 hover:text-white\"\r\n                            title=\"Picture in Picture\"\r\n                        >\r\n                            <PictureInPicture size={20} aria-hidden=\"true\" />\r\n                        </button>\r\n\r\n                        {/* Fullscreen Button */}\r\n                        <button\r\n                            onClick={onToggleFullscreen}\r\n                            aria-label=\"Toggle Fullscreen\"\r\n                            className=\"p-2 rounded-full transition-colors text-white/70 hover:text-white\"\r\n                            title=\"Fullscreen\"\r\n                        >\r\n                            <Maximize size={20} aria-hidden=\"true\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/overlay/SettingsOverlay.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { X, ChevronRight, Check } from \"lucide-react\";\r\n\r\ninterface SettingsOverlayProps {\r\n    show: boolean;\r\n    onClose: () => void;\r\n    tracks: { label: string; language: string; active: boolean }[];\r\n    audioTracks: { label: string; language: string; active: boolean }[];\r\n    qualities: { label: string; height: number; active: boolean }[];\r\n    playbackSpeed: number;\r\n    onTrackChange: (index: number) => void;\r\n    onAudioTrackChange: (index: number) => void;\r\n    onQualityChange: (index: number) => void;\r\n    onSpeedChange: (speed: number) => void;\r\n}\r\n\r\ntype Tab = 'main' | 'audio' | 'subtitle' | 'quality' | 'speed';\r\n\r\nexport default function SettingsOverlay({\r\n    show, onClose,\r\n    tracks = [], audioTracks = [], qualities = [], playbackSpeed = 1,\r\n    onTrackChange, onAudioTrackChange, onQualityChange, onSpeedChange\r\n}: SettingsOverlayProps) {\r\n    const [activeTab, setActiveTab] = useState<Tab>('main');\r\n\r\n    if (!show) {\r\n        if (activeTab !== 'main') setTimeout(() => setActiveTab('main'), 300);\r\n        return null;\r\n    }\r\n\r\n    const speeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2];\r\n\r\n    const renderMain = () => (\r\n        <div className=\"flex flex-col gap-2 min-w-[250px]\">\r\n            <h2 className=\"text-white text-lg font-bold mb-2 flex justify-between items-center\">\r\n                Settings\r\n                <button onClick={onClose}><X className=\"w-5 h-5 text-zinc-400 hover:text-white\" /></button>\r\n            </h2>\r\n\r\n            <button onClick={() => setActiveTab('quality')} disabled={qualities.length === 0} className={`flex items-center justify-between p-3 rounded text-sm transition-colors ${qualities.length === 0 ? 'text-white/30 cursor-not-allowed' : 'hover:bg-white/10 text-white'}`}>\r\n                <span>Quality</span>\r\n                <div className=\"flex items-center gap-2 text-zinc-400\">\r\n                    <span>{qualities.length > 0 ? (qualities.find(q => q.active)?.label || 'Auto') : 'Auto'}</span>\r\n                    <ChevronRight className=\"w-4 h-4\" />\r\n                </div>\r\n            </button>\r\n\r\n            <button onClick={() => setActiveTab('audio')} disabled={audioTracks.length === 0} className={`flex items-center justify-between p-3 rounded text-sm transition-colors ${audioTracks.length === 0 ? 'text-white/30 cursor-not-allowed' : 'hover:bg-white/10 text-white'}`}>\r\n                <span>Audio</span>\r\n                <div className=\"flex items-center gap-2 text-zinc-400\">\r\n                    <span>{audioTracks.length > 0 ? (audioTracks.find(t => t.active)?.label || 'Default') : 'Default'}</span>\r\n                    <ChevronRight className=\"w-4 h-4\" />\r\n                </div>\r\n            </button>\r\n\r\n            {tracks.length > 0 && (\r\n                <button onClick={() => setActiveTab('subtitle')} className=\"flex items-center justify-between p-3 rounded hover:bg-white/10 text-white text-sm transition-colors\">\r\n                    <span>Subtitles</span>\r\n                    <div className=\"flex items-center gap-2 text-zinc-400\">\r\n                        <span>{tracks.find(t => t.active)?.label || 'Off'}</span>\r\n                        <ChevronRight className=\"w-4 h-4\" />\r\n                    </div>\r\n                </button>\r\n            )}\r\n\r\n            <button onClick={() => setActiveTab('speed')} className=\"flex items-center justify-between p-3 rounded hover:bg-white/10 text-white text-sm transition-colors\">\r\n                <span>Speed</span>\r\n                <div className=\"flex items-center gap-2 text-zinc-400\">\r\n                    <span>{playbackSpeed}x</span>\r\n                    <ChevronRight className=\"w-4 h-4\" />\r\n                </div>\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    const renderList = (title: string, items: any[], onSelect: (idx: number) => void, getLabel: (item: any) => string, getActive: (item: any, idx: number) => boolean) => (\r\n        <div className=\"flex flex-col gap-1 min-w-[250px] max-h-[60vh] overflow-y-auto\">\r\n            <h2 className=\"text-white text-lg font-bold mb-2 flex items-center gap-2\">\r\n                <button onClick={() => setActiveTab('main')}><X className=\"w-5 h-5 rotate-45\" /></button>\r\n                {title}\r\n            </h2>\r\n            {items.map((item, idx) => {\r\n                const isActive = getActive(item, idx);\r\n                return (\r\n                    <button\r\n                        key={idx}\r\n                        onClick={() => { onSelect(idx); setActiveTab('main'); }}\r\n                        className={`flex items-center justify-between p-3 rounded text-sm transition-colors ${isActive ? 'bg-white/20 text-white font-medium' : 'hover:bg-white/10 text-zinc-300'}`}\r\n                    >\r\n                        <span>{getLabel(item)}</span>\r\n                        {isActive && <Check className=\"w-4 h-4\" />}\r\n                    </button>\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-center justify-center\" onClick={(e) => { if (e.target === e.currentTarget) onClose(); }}>\r\n            <div className=\"bg-zinc-900 border border-white/10 p-4 rounded-xl shadow-2xl animate-in fade-in zoom-in duration-200\">\r\n                {activeTab === 'main' && renderMain()}\r\n                {activeTab === 'quality' && renderList(\"Quality\", qualities, onQualityChange, (q) => q.label, (q) => q.active)}\r\n                {activeTab === 'audio' && renderList(\"Audio\", audioTracks, onAudioTrackChange, (t) => t.label, (t) => t.active)}\r\n                {activeTab === 'subtitle' && renderList(\"Subtitles\", [{ label: 'Off', active: !tracks.some(t => t.active) }, ...tracks], (idx) => onTrackChange(idx - 1), (t) => t.label, (t) => t.active)}\r\n                {activeTab === 'speed' && renderList(\"Playback Speed\", speeds, (idx) => onSpeedChange(speeds[idx]), (s) => s + 'x', (s) => s === playbackSpeed)}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1509, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/player/WebviewPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\r\nimport { Loader2 } from \"lucide-react\";\r\nimport PlayerControls from './overlay/PlayerControls';\r\nimport SettingsOverlay from './overlay/SettingsOverlay';\r\n\r\nexport interface WebviewPlayerRef {\r\n    seek: (time: number) => void;\r\n    setVolume: (vol: number) => void;\r\n    togglePlay: () => void;\r\n    setTrack: (index: number) => void;\r\n    setAudioTrack: (index: number) => void;\r\n    setQuality: (index: number) => void;\r\n    setSubtitleStyle: (style: { fontSize?: number, bgOpacity?: number, color?: string }) => void;\r\n    setPlaybackSpeed: (speed: number) => void;\r\n    togglePiP: () => void;\r\n}\r\n\r\ninterface WebviewPlayerProps {\r\n    src: string;\r\n    title?: string;\r\n    isSaved?: boolean;\r\n    initialVolume?: number;\r\n    subtitleStyle?: { fontSize?: number; bgOpacity?: number; color?: string };\r\n    onEnded?: () => void;\r\n    onStateUpdate?: (state: any) => void;\r\n    // Series Props\r\n    type?: 'movie' | 'tv';\r\n    season?: string;\r\n    episode?: string;\r\n    seasons?: any[];\r\n    onSeasonChange?: (s: number) => void;\r\n    onEpisodeChange?: (e: string) => void;\r\n}\r\n\r\nconst WebviewPlayer = forwardRef<WebviewPlayerRef, WebviewPlayerProps>(({\r\n    src, title, initialVolume = 1, subtitleStyle, onEnded, onStateUpdate,\r\n    type = 'movie', season = '1', episode = '1', seasons = [], onSeasonChange, onEpisodeChange\r\n}, ref) => {\r\n    const webviewRef = useRef<any>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const isReadyRef = useRef(false);\r\n    const callbacksRef = useRef({ onStateUpdate, onEnded, subtitleStyle });\r\n\r\n    // --- Overlay State ---\r\n    const [showControls, setShowControls] = useState(true); // Always start visible\r\n    const controlsTimeoutRef = useRef<NodeJS.Timeout>();\r\n    const [showSettings, setShowSettings] = useState(false);\r\n\r\n    interface PlayerState {\r\n        currentTime: number;\r\n        duration: number;\r\n        volume: number;\r\n        isMuted: boolean;\r\n        isPaused: boolean;\r\n        isSeeking: boolean;\r\n        seekValue: number;\r\n        tracks: { label: string; language: string; active: boolean }[];\r\n        audioTracks: { label: string; language: string; active: boolean }[];\r\n        qualities: { label: string; height: number; active: boolean }[];\r\n        providerType: string;\r\n    }\r\n\r\n    const [playerState, setPlayerState] = useState<PlayerState>({\r\n        currentTime: 0,\r\n        duration: 0,\r\n        volume: initialVolume,\r\n        isMuted: false,\r\n        isPaused: false,\r\n        isSeeking: false,\r\n        seekValue: 0,\r\n        tracks: [],\r\n        audioTracks: [],\r\n        qualities: [],\r\n        providerType: 'Native'\r\n    });\r\n\r\n    const safeExecute = (script: string, userGesture = false) => {\r\n        if (!isReadyRef.current || !webviewRef.current) return;\r\n        try {\r\n            // @ts-ignore\r\n            webviewRef.current.executeJavaScript(script, userGesture).catch((e: any) => {\r\n                if (e.message && e.message.includes('GUEST_VIEW_MANAGER_CALL')) return;\r\n                console.warn(\"[AG] Webview Exec Error:\", e.message);\r\n            });\r\n        } catch (e) { }\r\n    };\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        seek: (time) => safeExecute(`window.AG_CMD_SEEK && window.AG_CMD_SEEK(${time})`),\r\n        setVolume: (vol) => safeExecute(`window.AG_CMD_VOL && window.AG_CMD_VOL(${vol})`),\r\n        togglePlay: () => safeExecute(`window.AG_CMD_TOGGLE && window.AG_CMD_TOGGLE()`),\r\n        setTrack: (idx) => safeExecute(`window.AG_CMD_TRACK && window.AG_CMD_TRACK(${idx})`),\r\n        setAudioTrack: (idx) => safeExecute(`window.AG_CMD_AUDIO_TRACK && window.AG_CMD_AUDIO_TRACK(${idx})`),\r\n        setQuality: (idx) => safeExecute(`window.AG_CMD_QUALITY && window.AG_CMD_QUALITY(${idx})`),\r\n        setSubtitleStyle: (style) => safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(style)})`),\r\n        setPlaybackSpeed: (speed) => safeExecute(`window.AG_CMD_SPEED && window.AG_CMD_SPEED(${speed})`),\r\n        togglePiP: () => safeExecute(`window.AG_CMD_PIP && window.AG_CMD_PIP()`, true)\r\n    }));\r\n\r\n    // --- Overlay Handlers ---\r\n    const handleMouseMove = () => {\r\n        setShowControls(true);\r\n        if (controlsTimeoutRef.current) clearTimeout(controlsTimeoutRef.current);\r\n        if (!playerState.isPaused) {\r\n            controlsTimeoutRef.current = setTimeout(() => setShowControls(false), 5000); // 5s linger\r\n        }\r\n    };\r\n\r\n    const handleTogglePlay = () => {\r\n        safeExecute(`window.AG_CMD_TOGGLE && window.AG_CMD_TOGGLE()`);\r\n        // Optimistic update\r\n        setPlayerState(prev => ({ ...prev, isPaused: !prev.isPaused }));\r\n    };\r\n\r\n    const handleSeekChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const val = parseFloat(e.target.value);\r\n        setPlayerState(prev => ({ ...prev, isSeeking: true, seekValue: val }));\r\n    };\r\n\r\n    const handleSeekCommit = () => {\r\n        safeExecute(`window.AG_CMD_SEEK && window.AG_CMD_SEEK(${playerState.seekValue})`);\r\n        setTimeout(() => setPlayerState(prev => ({ ...prev, isSeeking: false })), 500);\r\n    };\r\n\r\n    const handleVolumeChange = (vol: number) => {\r\n        safeExecute(`window.AG_CMD_VOL && window.AG_CMD_VOL(${vol})`);\r\n        setPlayerState(prev => ({ ...prev, volume: vol, isMuted: vol === 0 }));\r\n    };\r\n\r\n    const handleToggleMute = () => {\r\n        const newMuted = !playerState.isMuted;\r\n        const newVol = newMuted ? 0 : (playerState.volume || 1);\r\n        safeExecute(`window.AG_CMD_VOL && window.AG_CMD_VOL(${newVol})`);\r\n        setPlayerState(prev => ({ ...prev, isMuted: newMuted, volume: newVol }));\r\n    };\r\n\r\n    const handleToggleFullscreen = () => {\r\n        if (!document.fullscreenElement) {\r\n            document.documentElement.requestFullscreen().catch((e) => console.error(\"Fullscreen error:\", e));\r\n        } else {\r\n            document.exitFullscreen().catch((e) => console.error(\"Exit Fullscreen error:\", e));\r\n        }\r\n    };\r\n\r\n    // Keep refs updated\r\n    useEffect(() => {\r\n        callbacksRef.current = { onStateUpdate, onEnded, subtitleStyle };\r\n        if (isReadyRef.current && subtitleStyle) {\r\n            safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(subtitleStyle)})`);\r\n        }\r\n    }, [onStateUpdate, onEnded, subtitleStyle]);\r\n\r\n    useEffect(() => {\r\n        const webview = webviewRef.current;\r\n        if (!webview) return;\r\n\r\n        const onDidFinishLoad = () => {\r\n            if (isReadyRef.current) return;\r\n            setIsLoading(false);\r\n\r\n            // Linger controls on startup\r\n            setShowControls(true);\r\n            if (controlsTimeoutRef.current) clearTimeout(controlsTimeoutRef.current);\r\n            controlsTimeoutRef.current = setTimeout(() => setShowControls(false), 5000);\r\n\r\n            const script = `\r\n                (function() {\r\n                    const AG_VERSION = 7; \r\n                    console.log(\" AG Script Injected & Started (v\" + AG_VERSION + \")\");\r\n                    const START_VOLUME = ${initialVolume};\r\n                    \r\n                    if (window.AG_VERSION === AG_VERSION) return;\r\n                    window.AG_INSTALLED = true;\r\n                    window.AG_VERSION = AG_VERSION;\r\n                    \r\n                    if (window.AG_INTERVAL_ID) clearInterval(window.AG_INTERVAL_ID);\r\n\r\n                    // --- HELPERS ---\r\n                    \r\n                    // DEBUG PROBE\r\n                    setTimeout(() => {\r\n                        console.log(\" STARTING PROBE...\");\r\n                        const globals = Object.keys(window).filter(k => \r\n                            k.includes('player') || k.includes('jw') || k.includes('hls') || k.includes('vid') || k.includes('media')\r\n                        );\r\n                        console.log(\" GLOBALS:\", globals);\r\n                        \r\n                        const v = document.querySelector('video');\r\n                        if (v) {\r\n                            console.log(\" VIDEO PROPS:\", Object.keys(v).filter(k => !k.startsWith('on') && !k.startsWith('webkit')));\r\n                            console.log(\" VIDEO SRC:\", v.src);\r\n                            console.log(\" VIDEO TRACKS:\", v.audioTracks ? v.audioTracks.length : 'N/A', v.textTracks ? v.textTracks.length : 'N/A');\r\n                        } else {\r\n                            console.log(\" NO VIDEO ELEMENT FOUND IN MAIN FRAME\");\r\n                            // Check frames\r\n                            const frames = document.querySelectorAll('iframe');\r\n                            console.log(\" IFRAMES FOUND:\", frames.length);\r\n                            frames.forEach((f, i) => console.log(' IFRAME ' + i + ':', f.src));\r\n                        }\r\n                    }, 5000);\r\n\r\n                    const findVideo = (root, depth = 0) => {\r\n                        if (!root) return null;\r\n                        \r\n                        // Check current root\r\n                        let v = root.querySelector('video');\r\n                        if (v) return { v, context: root.defaultView || window }; // Return video + window context\r\n\r\n                        // Check Shadow DOM\r\n                        if (root.createTreeWalker) {\r\n                            const w = root.createTreeWalker((root.body || root), NodeFilter.SHOW_ELEMENT, null, false);\r\n                            if (w) { \r\n                                let n; \r\n                                while(n = w.nextNode()) {\r\n                                    if(n.shadowRoot) { \r\n                                        const res = findVideo(n.shadowRoot, depth + 1); \r\n                                        if(res) return res; \r\n                                    } \r\n                                } \r\n                            }\r\n                        }\r\n\r\n                        // Check IFrames (Must have access)\r\n                        const fs = root.querySelectorAll('iframe');\r\n                        for(let f of fs) { \r\n                            try { \r\n                                let d = f.contentDocument || f.contentWindow?.document; \r\n                                if(d) { \r\n                                    const res = findVideo(d, depth + 1); \r\n                                    if(res) return res; \r\n                                } \r\n                            } catch(e){} \r\n                        }\r\n                        return null;\r\n                    };\r\n\r\n                    // --- ENGINE ---\r\n                    window.AG_VIDEO = null;\r\n                    window.AG_CTX = null; // Store the context (window) of the player\r\n\r\n                    const checkProviders = (v, ctx) => {\r\n                        const win = ctx || window;\r\n                        \r\n                        // 1. Check for HLS.js attached to specific props\r\n                        if (v._hls) return { type: 'hls', instance: v._hls };\r\n                        \r\n                        // 2. Check for global JWPlayer in context\r\n                        if (win.jwplayer && win.jwplayer().getState) return { type: 'jw', instance: win.jwplayer() };\r\n                        \r\n                        // 3. Global HLS in context\r\n                        if (win.hls && win.hls.audioTracks) return { type: 'hls', instance: win.hls };\r\n                        \r\n                        // 4. VideoJS\r\n                        // @ts-ignore\r\n                        if (v.player && v.player.tech_ && v.player.tech_.hls) return { type: 'hls', instance: v.player.tech_.hls };\r\n                        \r\n                        // 5. Clappr\r\n                        if (win.player && win.player.core && win.player.core.getCurrentPlayback) {\r\n                             const pb = win.player.core.getCurrentPlayback();\r\n                             if (pb._hls) return { type: 'hls', instance: pb._hls };\r\n                        }\r\n                        \r\n                        // 6. Plyr\r\n                        if (win.Plyr && v.plyr) return { type: 'plyr', instance: v.plyr };\r\n                        \r\n                        // 7. ArtPlayer\r\n                        if (win.Artplayer && win.Artplayer.instances.length > 0) return { type: 'art', instance: win.Artplayer.instances[0] };\r\n                        \r\n                        return null;\r\n                    };\r\n\r\n                    const updateState = () => {\r\n                        // Find Video if missing\r\n                        if (!window.AG_VIDEO || !window.AG_VIDEO.isConnected) {\r\n                            const found = findVideo(document);\r\n                            if (found) {\r\n                                window.AG_VIDEO = found.v;\r\n                                window.AG_CTX = found.context;\r\n                                \r\n                                const v = window.AG_VIDEO;\r\n                                if (!v.hasAGListeners && v) {\r\n                                    v.hasAGListeners = true;\r\n                                    console.log(' Video Attached');\r\n                                    \r\n                                    // AUTOPLAY & INITIAL VOLUME\r\n                                    v.volume = START_VOLUME;\r\n                                    v.muted = false;\r\n                                    const p = v.play();\r\n                                    if(p) p.catch(() => { v.muted = true; v.play(); });\r\n                                }\r\n                                \r\n                                // Detect Provider once attached\r\n                                const prov = checkProviders(v, window.AG_CTX);\r\n                                if (prov) {\r\n                                    console.log(' Provider Found:', prov.type);\r\n                                    if (prov.type === 'hls') window.AG_HLS = prov.instance;\r\n                                    if (prov.type === 'jw') window.AG_JW = prov.instance;\r\n                                }\r\n                            }\r\n                        }\r\n                        \r\n                        // Retry finding video periodically\r\n                        if (window.AG_VIDEO && !window.AG_VIDEO.isConnected) {\r\n                            window.AG_VIDEO = null;\r\n                            window.AG_CTX = null;\r\n                        }\r\n                        \r\n                        const v = window.AG_VIDEO;\r\n                        if (!v) return;\r\n\r\n                        const s = {\r\n                            currentTime: v.currentTime,\r\n                            duration: v.duration,\r\n                            volume: v.muted ? 0 : v.volume,\r\n                            isPaused: v.paused,\r\n                            tracks: [], audioTracks: [], qualities: [],\r\n                            providerType: window.AG_HLS ? 'HLS' : (window.AG_JW ? 'JW' : (v._hls ? 'HLS_Attached' : 'Native'))\r\n                        };\r\n                        \r\n                        // --- TRACKS MAPPING ---\r\n                        \r\n                        // 1. Subtitles (Standard + JW)\r\n                        if (window.AG_JW) {\r\n                             // JWPlayer Captions\r\n                             const caps = window.AG_JW.getCaptionsList ? window.AG_JW.getCaptionsList() : [];\r\n                             const currCap = window.AG_JW.getCurrentCaptions ? window.AG_JW.getCurrentCaptions() : -1;\r\n                             s.tracks = caps.map((t, idx) => ({\r\n                                 label: t.label || t.language || 'Sub ' + idx,\r\n                                 language: t.language, // JW uses 'id' sometimes\r\n                                 active: idx === currCap\r\n                             }));\r\n                        } else if (v.textTracks) {\r\n                            // Standard HTML5\r\n                            for(let i=0; i<v.textTracks.length; i++) {\r\n                                const t = v.textTracks[i];\r\n                                // Filter out metadata tracks if possible, mainly keep subtitles/captions\r\n                                if (t.kind === 'subtitles' || t.kind === 'captions' || !t.kind) {\r\n                                     s.tracks.push({ \r\n                                        label: t.label || t.language || 'Track ' + (i+1), \r\n                                        language: t.language, \r\n                                        active: t.mode === 'showing' \r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // 2. Audio Tracks\r\n                        if (window.AG_JW) {\r\n                            const audios = window.AG_JW.getAudioTracks ? window.AG_JW.getAudioTracks() : (window.AG_JW.getAudioTracks || []); \r\n                            if (typeof window.AG_JW.getAudioTracks === 'function') {\r\n                                const list = window.AG_JW.getAudioTracks();\r\n                                const curr = window.AG_JW.getCurrentAudioTrack();\r\n                                s.audioTracks = list.map((t, idx) => ({\r\n                                    label: t.label || t.language || t.name || 'Audio ' + idx,\r\n                                    language: t.language || 'unk',\r\n                                    active: idx === curr\r\n                                }));\r\n                            }\r\n                        } else if (window.AG_HLS && window.AG_HLS.audioTracks) {\r\n                             s.audioTracks = window.AG_HLS.audioTracks.map((t, idx) => ({\r\n                                 label: t.name || t.lang || t.language || 'Audio ' + idx,\r\n                                 language: t.lang || t.language || 'unk',\r\n                                 active: idx === window.AG_HLS.audioTrack\r\n                             }));\r\n                        } else if (v.audioTracks) {\r\n                            for(let i=0; i<v.audioTracks.length; i++) {\r\n                                const t = v.audioTracks[i];\r\n                                s.audioTracks.push({\r\n                                    label: t.label || t.language || 'Audio ' + (i+1),\r\n                                    language: t.language,\r\n                                    active: t.enabled\r\n                                });\r\n                            }\r\n                        }\r\n\r\n                        // 3. Quality Levels\r\n                        if (window.AG_JW && window.AG_JW.getQualityLevels) {\r\n                            const q = window.AG_JW.getQualityLevels();\r\n                            const curr = window.AG_JW.getCurrentQuality();\r\n                            s.qualities = q.map((t, idx) => ({\r\n                                label: t.label || t.height + 'p',\r\n                                height: t.height || 0,\r\n                                active: idx === curr\r\n                            }));\r\n                        } else if (window.AG_HLS && window.AG_HLS.levels) {\r\n                             s.qualities = window.AG_HLS.levels.map((t, idx) => ({\r\n                                 label: (t.height || 'Auto') + 'p',\r\n                                 height: t.height,\r\n                                 active: idx === window.AG_HLS.currentLevel \r\n                             }));\r\n                             s.qualities.unshift({ label: 'Auto', height: 0, active: window.AG_HLS.autoLevelEnabled });\r\n                        }\r\n\r\n                        console.log('ANTIGRAVITY_UPDATE:' + JSON.stringify(s));\r\n                    };\r\n\r\n                    window.AG_INTERVAL_ID = setInterval(updateState, 1000);\r\n\r\n                    // --- COMMANDS ---\r\n                    window.AG_CMD_SEEK = (t) => { if(window.AG_VIDEO) window.AG_VIDEO.currentTime = t; };\r\n                    \r\n                    window.AG_CMD_VOL = (v) => { \r\n                        if(window.AG_VIDEO) {\r\n                            // Standard Volume\r\n                            if (v <= 1) {\r\n                                window.AG_VIDEO.volume = v;\r\n                                if (window.AG_GAIN) window.AG_GAIN.gain.value = 1; // Reset boost\r\n                            } \r\n                            // Boost Mode (Web Audio API)\r\n                            else {\r\n                                window.AG_VIDEO.volume = 1; // Max out native\r\n                                \r\n                                try {\r\n                                    if (!window.AG_AUDIO_CTX) {\r\n                                        const win = window.AG_CTX || window; // Use the video's window context\r\n                                        const AudioContext = win.AudioContext || win.webkitAudioContext;\r\n                                        window.AG_AUDIO_CTX = new AudioContext();\r\n                                        window.AG_src = window.AG_AUDIO_CTX.createMediaElementSource(window.AG_VIDEO);\r\n                                        window.AG_GAIN = window.AG_AUDIO_CTX.createGain();\r\n                                        window.AG_src.connect(window.AG_GAIN);\r\n                                        window.AG_GAIN.connect(window.AG_AUDIO_CTX.destination);\r\n                                        console.log(' Audio Boost Initialized in context:', win === window ? 'Top' : 'Iframe');\r\n                                    }\r\n                                    if (window.AG_GAIN && window.AG_AUDIO_CTX) {\r\n                                        // Resume context if suspended (browser autoplay policy)\r\n                                        if (window.AG_AUDIO_CTX.state === 'suspended') {\r\n                                            window.AG_AUDIO_CTX.resume();\r\n                                        }\r\n                                        window.AG_GAIN.gain.value = v; // Apply boost (e.g., 2.5)\r\n                                        console.log(' Boost:', v);\r\n                                    }\r\n                                } catch(e) {\r\n                                    console.error('Audio Boost Error:', e);\r\n                                }\r\n                            }\r\n                            \r\n                            window.AG_VIDEO.muted = v === 0; \r\n                        } \r\n                    };\r\n                    \r\n                    window.AG_CMD_TOGGLE = () => { if(window.AG_VIDEO) { if(window.AG_VIDEO.paused) window.AG_VIDEO.play(); else window.AG_VIDEO.pause(); } };\r\n                    \r\n                    // NEW: Track Commands\r\n                    window.AG_CMD_TRACK = (idx) => {\r\n                        console.log(' CMD_TRACK:', idx);\r\n                        // Subtitles\r\n                        if (window.AG_JW) {\r\n                            window.AG_JW.setCurrentCaptions(idx);\r\n                        } else {\r\n                            // Native / HLS\r\n                            // 1. Try HLS specific controller if attached\r\n                            if (window.AG_VIDEO && window.AG_VIDEO._hls) {\r\n                                console.log(' Setting HLS subtitleTrack:', idx);\r\n                                window.AG_VIDEO._hls.subtitleTrack = idx;\r\n                            }\r\n                            \r\n                            // 2. Fallback to Native TextTracks (Aggressive)\r\n                            if (window.AG_VIDEO && window.AG_VIDEO.textTracks) {\r\n                                for(let i=0; i<window.AG_VIDEO.textTracks.length; i++) {\r\n                                    // Disable all first\r\n                                    window.AG_VIDEO.textTracks[i].mode = 'disabled';\r\n                                }\r\n                                if (idx >= 0 && window.AG_VIDEO.textTracks[idx]) {\r\n                                    console.log(' Enabling Native Track:', idx);\r\n                                    window.AG_VIDEO.textTracks[idx].mode = 'showing';\r\n                                } else {\r\n                                    console.log(' All Native Tracks Disabled');\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    window.AG_CMD_AUDIO_TRACK = (idx) => {\r\n                         // Audio\r\n                         if (window.AG_JW) {\r\n                             window.AG_JW.setCurrentAudioTrack(idx);\r\n                         } else if (window.AG_HLS) {\r\n                             window.AG_HLS.audioTrack = idx;\r\n                         } else if (window.AG_VIDEO && window.AG_VIDEO.audioTracks) {\r\n                             for(let i=0; i<window.AG_VIDEO.audioTracks.length; i++) {\r\n                                 window.AG_VIDEO.audioTracks[i].enabled = (i === idx);\r\n                             }\r\n                         }\r\n                    };\r\n\r\n                    window.AG_CMD_QUALITY = (idx) => {\r\n                         // Quality\r\n                         if (window.AG_JW) {\r\n                             window.AG_JW.setCurrentQuality(idx);\r\n                         } else if (window.AG_HLS) {\r\n                             // index -1 usually means Auto in UI list if shifted, but HLS uses -1 for auto\r\n                             // If our UI list has Auto at 0, we need to map.\r\n                             // Assuming UI passes literal index from the qualities array constructed above.\r\n                             // If auto is present, it's usually the first item or handled specially.\r\n                             // Let's assume idx maps to the levels array index directly, unless it's auto.\r\n                             \r\n                             // If we constructed: [Auto, 360p, 720p...]\r\n                             // Then idx 0 = Auto.\r\n                             if (idx === 0 && window.AG_HLS.autoLevelEnabled !== undefined) {\r\n                                 window.AG_HLS.currentLevel = -1; // Auto\r\n                             } else {\r\n                                 // Offset by 1 if Auto is in list\r\n                                 window.AG_HLS.currentLevel = idx - 1; \r\n                             }\r\n                         }\r\n                    };\r\n\r\n                    window.AG_CMD_PIP = () => { if(window.AG_VIDEO) { if (document.pictureInPictureElement) document.exitPictureInPicture(); else window.AG_VIDEO.requestPictureInPicture(); } };\r\n                    \r\n                    // --- BLOCKING ---\r\n                    window.open = function() { return null; };\r\n                    window.onbeforeunload = null; \r\n                    \r\n                    const blockCss = \\`\r\n                        .ad, .ads, .popup, [class*=\"ad-\"], [id*=\"ad-\"], iframe[src*=\"ads\"] { display: none !important; }\r\n                        video::-webkit-media-controls { display: none !important; }\r\n                    \\`;\r\n                    const styleEl = document.createElement('style');\r\n                    styleEl.textContent = blockCss;\r\n                    document.head.appendChild(styleEl);\r\n\r\n                    // Kill popups\r\n                    setInterval(() => {\r\n                        const selectors = ['[class*=\"popup\"]', '[id*=\"popup\"]', 'iframe[src*=\"ads\"]'];\r\n                        selectors.forEach(sel => {\r\n                            try {\r\n                                document.querySelectorAll(sel).forEach(el => {\r\n                                    if (el && el.parentNode && el.tagName !== 'VIDEO') {\r\n                                        try { el.remove(); } catch(e){}\r\n                                    }\r\n                                });\r\n                            } catch(e){}\r\n                        });\r\n                    }, 500);\r\n                })();\r\n            `;\r\n\r\n            webview.executeJavaScript(script);\r\n            isReadyRef.current = true;\r\n            if (subtitleStyle) safeExecute(`window.AG_CMD_SUB_STYLE && window.AG_CMD_SUB_STYLE(${JSON.stringify(subtitleStyle)})`);\r\n        };\r\n\r\n        const onConsole = (e: any) => {\r\n            const msg = e.message;\r\n            // Forward all logs for debugging \"Shazam\" issue\r\n            console.log('[WebView]:', msg);\r\n\r\n            if (msg.startsWith('ANTIGRAVITY_UPDATE:')) {\r\n                try {\r\n                    const data = JSON.parse(msg.substring(19));\r\n                    if (!data) return;\r\n                    setPlayerState(prev => ({\r\n                        ...prev,\r\n                        currentTime: data.currentTime || 0,\r\n                        duration: data.duration || 0,\r\n                        isPaused: data.isPaused,\r\n                        volume: data.volume,\r\n                        isMuted: data.volume === 0,\r\n                        tracks: data.tracks || [],\r\n                        audioTracks: data.audioTracks || [],\r\n                        qualities: data.qualities || []\r\n                    }));\r\n                    callbacksRef.current.onStateUpdate?.(data);\r\n                } catch (e) { }\r\n            } else if (msg === 'ANTIGRAVITY_ENDED') {\r\n                callbacksRef.current.onEnded?.();\r\n            }\r\n        };\r\n\r\n        const onDomReady = () => onDidFinishLoad();\r\n        const onDidFinishLoadEvent = () => onDidFinishLoad();\r\n\r\n        webview.addEventListener('did-finish-load', onDidFinishLoadEvent);\r\n        webview.addEventListener('dom-ready', onDomReady);\r\n        webview.addEventListener('console-message', onConsole);\r\n\r\n        // Prevent main process new-window (Fix for crash)\r\n        // @ts-ignore\r\n        webview.addEventListener('new-window', (e: any) => {\r\n            console.log('[Webview] Blocked popup:', e.url);\r\n            e.preventDefault();\r\n        });\r\n\r\n        return () => {\r\n            isReadyRef.current = false;\r\n            webview.removeEventListener('did-finish-load', onDidFinishLoadEvent);\r\n            webview.removeEventListener('dom-ready', onDomReady);\r\n            webview.removeEventListener('console-message', onConsole);\r\n        };\r\n    }, [src, initialVolume]);\r\n\r\n    return (\r\n        <div\r\n            className=\"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group\"\r\n            onMouseMove={handleMouseMove}\r\n            onMouseLeave={() => setShowControls(false)}\r\n        >\r\n            {isLoading && (\r\n                <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n                    <Loader2 className=\"w-10 h-10 text-white animate-spin\" />\r\n                </div>\r\n            )}\r\n\r\n            <webview\r\n                ref={webviewRef}\r\n                src={src}\r\n                className=\"w-full h-full border-0 transition-opacity duration-500 ease-in-out\"\r\n                style={{\r\n                    width: '100vw',\r\n                    height: '100vh',\r\n                    background: '#000',\r\n                    opacity: isLoading ? 0 : 1\r\n                }}\r\n                // @ts-ignore\r\n                allowpopups=\"false\"\r\n                // @ts-ignore\r\n                disablewebsecurity=\"true\"\r\n                webpreferences=\"contextIsolation=no, nodeIntegration=no, webSecurity=no, autoplayPolicy=no-user-gesture-required\"\r\n                useragent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36\"\r\n            />\r\n\r\n            {/* Interaction Layer - Intercepts clicks to prevent native controls/ads from activating */}\r\n            <div\r\n                className=\"absolute inset-0 z-10\"\r\n                onClick={handleTogglePlay}\r\n                onDoubleClick={handleToggleFullscreen}\r\n            />\r\n\r\n            <PlayerControls\r\n                show={showControls || playerState.isPaused || isLoading}\r\n                // @ts-ignore\r\n                providerType={playerState.providerType}\r\n                tracks={playerState.tracks}\r\n                audioTracks={playerState.audioTracks}\r\n                qualities={playerState.qualities}\r\n                title={title || \"\"}\r\n                currentTime={playerState.currentTime}\r\n                duration={playerState.duration}\r\n                isPaused={playerState.isPaused}\r\n                volume={playerState.volume}\r\n                isMuted={playerState.isMuted}\r\n                isSaved={false} // Todo: connect to store\r\n                downloadUrl={null}\r\n                isSeeking={playerState.isSeeking}\r\n                seekValue={playerState.seekValue}\r\n                type={type}\r\n                season={season}\r\n                episode={episode}\r\n                seasons={seasons}\r\n                onSeasonChange={onSeasonChange}\r\n                onEpisodeChange={onEpisodeChange}\r\n                onTogglePlay={handleTogglePlay}\r\n                onSeekChange={handleSeekChange}\r\n                onSeekCommit={handleSeekCommit}\r\n                onVolumeChange={handleVolumeChange}\r\n                onToggleMute={handleToggleMute}\r\n                onToggleLibrary={() => { }}\r\n                onDownload={() => { }}\r\n                onToggleSettings={() => setShowSettings(!showSettings)}\r\n                onTogglePiP={() => safeExecute(`window.AG_CMD_PIP && window.AG_CMD_PIP()`, true)}\r\n                onToggleFullscreen={handleToggleFullscreen}\r\n            />\r\n\r\n            <SettingsOverlay\r\n                show={showSettings}\r\n                onClose={() => setShowSettings(false)}\r\n                tracks={playerState.tracks}\r\n                audioTracks={playerState.audioTracks}\r\n                qualities={playerState.qualities}\r\n                playbackSpeed={1} // Todo: sync speed\r\n                onTrackChange={(idx) => safeExecute(`window.AG_CMD_TRACK && window.AG_CMD_TRACK(${idx})`)}\r\n                onAudioTrackChange={(idx) => safeExecute(`window.AG_CMD_AUDIO_TRACK && window.AG_CMD_AUDIO_TRACK(${idx})`)}\r\n                onQualityChange={(idx) => safeExecute(`window.AG_CMD_QUALITY && window.AG_CMD_QUALITY(${idx})`)}\r\n                onSpeedChange={(speed) => safeExecute(`window.AG_CMD_SPEED && window.AG_CMD_SPEED(${speed})`)}\r\n            />\r\n        </div>\r\n    );\r\n});\r\n\r\nWebviewPlayer.displayName = \"WebviewPlayer\";\r\nexport default WebviewPlayer;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2238, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\nexport function formatDuration(minutes: number): string {\r\n    const h = Math.floor(minutes / 60);\r\n    const m = minutes % 60;\r\n    return h > 0 ? `${h}h ${m}m` : `${m}m`;\r\n}\r\n\r\nexport function formatDate(date: string): string {\r\n    return new Date(date).toLocaleDateString(\"en-US\", {\r\n        year: \"numeric\",\r\n        month: \"long\",\r\n        day: \"numeric\",\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACxB;AAEO,SAAS,eAAe,OAAe;IAC1C,MAAM,IAAI,KAAK,KAAK,CAAC,UAAU;IAC/B,MAAM,IAAI,UAAU;IACpB,OAAO,IAAI,IAAI,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC;AAC1C;AAEO,SAAS,WAAW,IAAY;IACnC,OAAO,IAAI,KAAK,MAAM,kBAAkB,CAAC,SAAS;QAC9C,MAAM;QACN,OAAO;QACP,KAAK;IACT;AACJ"}},
    {"offset": {"line": 2272, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/components/UI/button.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { motion, HTMLMotionProps } from \"framer-motion\";\r\nimport { Loader2, Check, X } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n    variant?: \"primary\" | \"secondary\" | \"ghost\" | \"danger\";\r\n    size?: \"sm\" | \"md\" | \"lg\";\r\n    state?: \"default\" | \"loading\" | \"success\" | \"error\";\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(({\r\n    className,\r\n    variant = \"primary\",\r\n    size = \"md\",\r\n    state = \"default\",\r\n    children,\r\n    disabled,\r\n    ...props\r\n}, ref) => {\r\n\r\n    const variants = {\r\n        primary: \"bg-white text-black hover:bg-zinc-200 shadow-lg hover:shadow-xl\",\r\n        secondary: \"bg-zinc-800 text-white border border-white/10 hover:bg-zinc-700 hover:border-white/20\",\r\n        ghost: \"bg-transparent text-zinc-300 hover:text-white hover:bg-white/5\",\r\n        danger: \"bg-red-600 text-white hover:bg-red-500 shadow-red-900/20\"\r\n    };\r\n\r\n    const sizes = {\r\n        sm: \"px-3 py-1.5 text-xs\",\r\n        md: \"px-6 py-3 text-sm font-semibold\",\r\n        lg: \"px-8 py-4 text-base font-bold\"\r\n    };\r\n\r\n    const widthMap = {\r\n        default: \"auto\",\r\n        loading: \"auto\",\r\n        success: \"auto\",\r\n        error: \"auto\"\r\n    }\r\n\r\n    return (\r\n        <motion.button\r\n            ref={ref}\r\n            className={cn(\r\n                \"relative rounded-full inline-flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden\",\r\n                variants[variant],\r\n                sizes[size],\r\n                className\r\n            )}\r\n            disabled={state === 'loading' || disabled}\r\n            whileHover={state === 'default' && !disabled ? { scale: 1.02, y: -1 } : {}}\r\n            whileTap={state === 'default' && !disabled ? { scale: 0.98 } : {}}\r\n            layout\r\n            {...props as any} // Cast to any to avoid complex framer-motion type conflicts with ref\r\n        >\r\n            {state === 'loading' && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, width: 0 }}\r\n                    animate={{ opacity: 1, width: \"auto\" }}\r\n                    exit={{ opacity: 0, width: 0 }}\r\n                >\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                </motion.div>\r\n            )}\r\n\r\n            {children}\r\n\r\n            {state === 'success' && (\r\n                <motion.div\r\n                    initial={{ scale: 0 }}\r\n                    animate={{ scale: 1 }}\r\n                    className=\"ml-2 text-green-500\"\r\n                >\r\n                    <Check size={18} />\r\n                </motion.div>\r\n            )}\r\n        </motion.button>\r\n    );\r\n});\r\n\r\nButton.displayName = \"Button\";\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAcO,MAAM,uBAAS,2KAAgB,MAAiC,CAAC,EACpE,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,QAAQ,SAAS,EACjB,QAAQ,EACR,QAAQ,EACR,GAAG,OACN,EAAE;IAEC,MAAM,WAAW;QACb,SAAS;QACT,WAAW;QACX,OAAO;QACP,QAAQ;IACZ;IAEA,MAAM,QAAQ;QACV,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,MAAM,WAAW;QACb,SAAS;QACT,SAAS;QACT,SAAS;QACT,OAAO;IACX;IAEA,qBACI,6LAAC,uLAAM,CAAC,MAAM;QACV,KAAK;QACL,WAAW,IAAA,4HAAE,EACT,yJACA,QAAQ,CAAC,QAAQ,EACjB,KAAK,CAAC,KAAK,EACX;QAEJ,UAAU,UAAU,aAAa;QACjC,YAAY,UAAU,aAAa,CAAC,WAAW;YAAE,OAAO;YAAM,GAAG,CAAC;QAAE,IAAI,CAAC;QACzE,UAAU,UAAU,aAAa,CAAC,WAAW;YAAE,OAAO;QAAK,IAAI,CAAC;QAChE,MAAM;QACL,GAAG,KAAK;;YAER,UAAU,2BACP,6LAAC,uLAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAO;gBACrC,MAAM;oBAAE,SAAS;oBAAG,OAAO;gBAAE;0BAE7B,cAAA,6LAAC,0NAAO;oBAAC,WAAU;;;;;;;;;;;YAI1B;YAEA,UAAU,2BACP,6LAAC,uLAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,OAAO;gBAAE;gBACpB,SAAS;oBAAE,OAAO;gBAAE;gBACpB,WAAU;0BAEV,cAAA,6LAAC,gNAAK;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAKjC;;AAEA,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 2385, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Edward%20Magejo/.gemini/antigravity/playground/inertial-event/src/app/watch/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { ArrowLeft, Loader2, AlertCircle } from \"lucide-react\";\r\nimport { contentApi } from \"@/lib/api/content\";\r\nimport sourceProvider from \"@/services/sourceProvider\";\r\nimport { usePlayerStore } from \"@/lib/store/playerStore\";\r\nimport { useHistoryStore } from \"@/lib/store/historyStore\";\r\nimport { VideoPlayer } from \"@/components/player/VideoPlayer\";\r\nimport WebviewPlayer from \"@/components/player/WebviewPlayer\";\r\nimport { Button } from \"@/components/UI/button\";\r\nimport { Content } from \"@/lib/types/content\";\r\n\r\nexport default function WatchPage({ params }: { params: Promise<{ id: string }> }) {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const type = (searchParams.get(\"type\") as 'movie' | 'tv') || 'movie';\r\n\r\n    // Unwrap params (Next.js 15+)\r\n    const { id } = React.use(params);\r\n\r\n    const [content, setContent] = useState<Content | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [sourceUrl, setSourceUrl] = useState<string | null>(null);\r\n    const [isEmbed, setIsEmbed] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [currentSeason, setCurrentSeason] = useState(Number(searchParams.get(\"season\")) || 1);\r\n    const [currentEpisode, setCurrentEpisode] = useState(Number(searchParams.get(\"episode\")) || 1);\r\n    const { setDuration, setCurrentTime, setPlaying } = usePlayerStore();\r\n    const addToHistory = useHistoryStore(state => state.addToHistory);\r\n    const isSaved = false; // Todo: Implement library store\r\n\r\n    // Save to history when content loads\r\n    useEffect(() => {\r\n        if (content) {\r\n            addToHistory(content);\r\n        }\r\n    }, [content, addToHistory]);\r\n\r\n    // 1. Fetch Content Details\r\n    useEffect(() => {\r\n        let mounted = true;\r\n        async function fetchDetails() {\r\n            try {\r\n                const details = await contentApi.getDetails(id, type);\r\n                if (!mounted) return;\r\n                if (!details) {\r\n                    setError(\"Content not found\");\r\n                    return;\r\n                }\r\n                setContent(details);\r\n            } catch (err) {\r\n                if (mounted) setError(\"Failed to load content details\");\r\n            }\r\n        }\r\n        fetchDetails();\r\n        return () => { mounted = false; };\r\n    }, [id, type]);\r\n\r\n    // 2. Fetch Sources when content or episode changes\r\n    useEffect(() => {\r\n        if (!content) return;\r\n        let mounted = true;\r\n\r\n        async function fetchSources() {\r\n            setLoading(true);\r\n            setError(null);\r\n            try {\r\n                const sourceType = type === 'movie' ? 'movie' : type === 'tv' ? 'series' : 'anime';\r\n                const sourcesMap = await sourceProvider.getAllSources({\r\n                    id: content.id,\r\n                    title: content.title,\r\n                    type: sourceType\r\n                }, currentSeason, currentEpisode);\r\n\r\n                if (!mounted) return;\r\n\r\n                let bestSourceObj: any = null;\r\n                const vidlink = sourcesMap.get('vidlink');\r\n                const torrent = sourcesMap.get('torrent');\r\n\r\n                if (vidlink && vidlink.length > 0) {\r\n                    bestSourceObj = vidlink[0];\r\n                } else if (torrent && torrent.length > 0) {\r\n                    bestSourceObj = torrent[0];\r\n                } else {\r\n                    setError(\"No playable sources found for this episode\");\r\n                }\r\n\r\n                if (bestSourceObj) {\r\n                    setSourceUrl(bestSourceObj.url);\r\n                    setIsEmbed(bestSourceObj.type === 'embed');\r\n                } else {\r\n                    setSourceUrl(null);\r\n                }\r\n            } catch (err: any) {\r\n                if (mounted) setError(err.message || \"Failed to load sources\");\r\n            } finally {\r\n                if (mounted) setLoading(false);\r\n            }\r\n        }\r\n\r\n        fetchSources();\r\n        return () => { mounted = false; };\r\n    }, [content, currentSeason, currentEpisode, type]);\r\n\r\n    const handleSeasonChange = (s: number) => {\r\n        setCurrentSeason(s);\r\n        setCurrentEpisode(1); // Reset to ep 1\r\n    };\r\n\r\n    const handleEpisodeChange = (e: string) => {\r\n        setCurrentEpisode(parseInt(e));\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex h-screen w-full items-center justify-center bg-black\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                    <Loader2 className=\"h-10 w-10 animate-spin text-red-600\" />\r\n                    <p className=\"text-zinc-400 font-medium animate-pulse\">Locating stream...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error || !content) {\r\n        return (\r\n            <div className=\"flex h-screen w-full items-center justify-center bg-black\">\r\n                <div className=\"text-center space-y-4 max-w-md px-6\">\r\n                    <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto\" />\r\n                    <h2 className=\"text-2xl font-bold text-white\">Playback Error</h2>\r\n                    <p className=\"text-zinc-400\">{error || \"Unknown error occurred\"}</p>\r\n                    <Button onClick={() => router.back()} variant=\"secondary\">\r\n                        <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n                        Go Back\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative h-screen w-full bg-black overflow-hidden flex flex-col\">\r\n            {/* Top Bar / Navigation Overlay */}\r\n            <div className={`absolute top-0 left-0 w-full z-20 p-6 bg-gradient-to-b from-black/80 to-transparent flex items-center justify-between pointer-events-none transition-opacity duration-300 ${isEmbed ? 'hover:opacity-100 opacity-0' : 'opacity-100'}`}>\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    className=\"pointer-events-auto hover:bg-white/10 text-white\"\r\n                    onClick={() => router.back()}\r\n                >\r\n                    <ArrowLeft className=\"mr-2 h-5 w-5\" />\r\n                    Back\r\n                </Button>\r\n\r\n                <div className=\"text-right\">\r\n                    <h1 className=\"text-lg font-bold text-white drop-shadow-md\">{content.title}</h1>\r\n                    {type === 'tv' && <p className=\"text-sm text-zinc-300\">Season {currentSeason}  Episode {currentEpisode}</p>}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Player Container */}\r\n            <div className=\"flex-1 flex items-center justify-center bg-black\">\r\n                {sourceUrl ? (\r\n                    isEmbed ? (\r\n                        <WebviewPlayer\r\n                            src={sourceUrl}\r\n                            title={content.title}\r\n                            isSaved={isSaved}\r\n                            type={type}\r\n                            season={currentSeason.toString()}\r\n                            episode={currentEpisode.toString()}\r\n                            seasons={content.seasonsList}\r\n                            onSeasonChange={handleSeasonChange}\r\n                            onEpisodeChange={handleEpisodeChange}\r\n                            onStateUpdate={(state) => {\r\n                                console.log(\"[WatchPage] Webview State Update:\", state);\r\n                            }}\r\n                        />\r\n                    ) : (\r\n                        <div className=\"w-full h-full max-w-[1920px]\">\r\n                            <VideoPlayer\r\n                                src={sourceUrl}\r\n                                poster={content.backdrop || content.poster}\r\n                                title={content.title}\r\n                                onEnded={() => { console.log(\"Video ended\"); }}\r\n                            />\r\n                        </div>\r\n                    )\r\n                ) : (\r\n                    <div className=\"text-zinc-500\">Source URL missing</div>\r\n                )}\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}